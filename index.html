<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yalla Scooter | Tactical Command Center</title>
    
    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-deep: #050a14;
            --panel-bg: rgba(15, 23, 42, 0.8);
            --accent: #00f2ea; /* Ù„ÙˆÙ† ØªÙƒØªÙŠÙƒÙŠ ÙØ³ÙÙˆØ±ÙŠ */
            --accent-glow: rgba(0, 242, 234, 0.3);
            --text-main: #e2e8f0;
            --danger: #ff4d4d;
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; outline: none; }
        body { margin: 0; background: var(--bg-deep); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        /* --- Sidebar Premium --- */
        .sidebar { width: 260px; background: #070d19; border-left: 1px solid #1e293b; display: flex; flex-direction: column; z-index: 100; box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
        .logo-area { padding: 40px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo-area h1 { font-family: 'Orbitron', sans-serif; font-size: 20px; color: var(--accent); margin: 0; letter-spacing: 2px; text-shadow: 0 0 10px var(--accent-glow); }
        
        .nav-group { flex: 1; padding: 20px 0; }
        .nav-item { padding: 18px 30px; cursor: pointer; display: flex; align-items: center; gap: 15px; color: #64748b; font-weight: 700; transition: 0.3s; position: relative; }
        .nav-item i { font-size: 18px; width: 25px; }
        .nav-item:hover, .nav-item.active { color: var(--accent); background: linear-gradient(to left, rgba(0, 242, 234, 0.05), transparent); }
        .nav-item.active::after { content: ''; position: absolute; right: 0; top: 15%; height: 70%; width: 4px; background: var(--accent); box-shadow: 0 0 15px var(--accent); }

        /* --- Main Content Area --- */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; background: radial-gradient(circle at top right, #0a192f, transparent); }
        .top-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .sys-status { font-size: 12px; color: var(--accent); background: rgba(0,242,234,0.1); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--accent-glow); }

        /* --- Grid System --- */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .kpi-card { background: var(--panel-bg); border: 1px solid rgba(255,255,255,0.05); padding: 25px; border-radius: 4px; position: relative; backdrop-filter: blur(10px); }
        .kpi-card::before { content: ''; position: absolute; top:0; left:0; width: 100%; height: 2px; background: linear-gradient(to left, var(--accent), transparent); }
        .kpi-label { font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
        .kpi-value { font-family: 'Orbitron', sans-serif; font-size: 28px; display: block; margin-top: 10px; color: #fff; }

        /* --- Active Trips Section --- */
        .fleet-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .scooter-card { background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; transition: 0.3s; }
        .scooter-card:hover { border-color: var(--accent); transform: translateY(-5px); }
        .scooter-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .timer-val { color: var(--accent); font-family: 'Orbitron', sans-serif; font-size: 20px; }

        /* --- AI Floating Brain & Side Panel --- */
        #ai-btn { 
            position: fixed; bottom: 40px; left: 40px; width: 70px; height: 70px; 
            background: #000; border: 2px solid var(--accent); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 30px;
            cursor: pointer; box-shadow: 0 0 20px var(--accent-glow); z-index: 1000;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #ai-btn:hover { transform: scale(1.1) rotate(15deg); box-shadow: 0 0 40px var(--accent); }
        
        .ai-drawer { 
            position: fixed; top: 0; left: -450px; width: 420px; height: 100%; 
            background: rgba(7, 13, 25, 0.95); border-right: 1px solid var(--accent-glow);
            z-index: 1001; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px); display: flex; flex-direction: column;
        }
        .ai-drawer.open { left: 0; }
        .ai-chat-body { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px; }
        .ai-msg { padding: 15px; border-radius: 12px; font-size: 14px; max-width: 85%; border: 1px solid rgba(255,255,255,0.05); }
        .ai-msg.bot { background: rgba(0, 242, 234, 0.05); color: var(--accent); align-self: flex-start; }
        .ai-msg.user { background: rgba(255,255,255,0.05); align-self: flex-end; }
        
        .ai-footer { padding: 20px; border-top: 1px solid rgba(255,255,255,0.05); display: flex; gap: 10px; }
        .ai-input { flex: 1; background: transparent; border: 1px solid #334155; color: white; padding: 12px; border-radius: 5px; }

        /* --- Login System --- */
        #login-overlay { position: fixed; inset: 0; background: #020617; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-box { width: 400px; padding: 50px; background: #070d19; border: 1px solid var(--accent-glow); text-align: center; border-radius: 4px; }
        .login-box input { width: 100%; padding: 15px; background: #000; border: 1px solid #1e293b; color: var(--accent); font-family: 'Orbitron', sans-serif; font-size: 24px; text-align: center; margin-bottom: 25px; }
        .btn-auth { background: var(--accent); color: #000; border: none; width: 100%; padding: 15px; font-weight: 900; cursor: pointer; letter-spacing: 2px; }

        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <!-- Login -->
    <div id="login-overlay">
        <div class="login-box">
            <h1 style="font-family: Orbitron; color: var(--accent); margin-bottom: 10px;">TACTICAL ACCESS</h1>
            <p style="color: #64748b; font-size: 12px; margin-bottom: 30px;">IDENTITY VERIFICATION REQUIRED</p>
            <input type="password" id="passInput" placeholder="0000">
            <button onclick="login()" class="btn-auth">AUTHORIZE</button>
        </div>
    </div>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="logo-area">
            <h1>YALLA PRO</h1>
            <small style="color: #475569; letter-spacing: 3px;">TACTICAL OS</small>
        </div>
        <div class="nav-group">
            <div class="nav-item active" onclick="nav('rental')"><i class="fas fa-satellite-dish"></i> Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­ÙŠØ©</div>
            <div id="adm-btn" class="nav-item" style="display:none" onclick="nav('admin')"><i class="fas fa-shield-alt"></i> Ù…Ø±ÙƒØ² Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</div>
            <div class="nav-item" onclick="nav('maintenance')"><i class="fas fa-microchip"></i> Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
        </div>
        <div class="nav-item" style="margin-top:auto; color: var(--danger)" onclick="location.reload()">
            <i class="fas fa-power-off"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </div>
    </nav>

    <!-- Content -->
    <main class="main-content">
        <div class="top-header">
            <h2 id="page-title" style="margin:0; font-weight: 900;">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³Ø·ÙˆÙ„ Ø§Ù„Ù„Ø­Ø¸ÙŠØ©</h2>
            <div class="sys-status">
                <i class="fas fa-circle" style="font-size:8px; margin-left:5px;"></i> Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØªØµÙ„: <span id="clock">00:00:00</span>
            </div>
        </div>

        <!-- KPI Row -->
        <div class="kpi-grid">
            <div class="kpi-card"><span class="kpi-label">Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…</span><span id="kpi-rev" class="kpi-value">0</span></div>
            <div class="kpi-card"><span class="kpi-label">Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span><span id="kpi-active" class="kpi-value">0</span></div>
            <div class="kpi-card"><span class="kpi-label">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</span><span class="kpi-value" style="color:var(--accent)">12</span></div>
            <div class="kpi-card"><span class="kpi-label">ÙƒÙØ§Ø¡Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</span><span class="kpi-value">98%</span></div>
        </div>

        <!-- Section: Rental -->
        <div id="sec-rental" class="section active">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0"><i class="fas fa-motorcycle"></i> Ø£Ø¬Ù‡Ø²Ø© ØªØ­Øª Ø§Ù„Ø®Ø¯Ù…Ø©</h3>
                <button onclick="newTripPopup()" style="background:var(--accent); border:none; padding:10px 20px; font-weight:bold; cursor:pointer;">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
            </div>
            <div id="fleet-container" class="fleet-grid">
                <!-- Dynamic Content -->
            </div>
        </div>

        <!-- Section: Admin (Placeholder) -->
        <div id="sec-admin" class="section">
            <h3><i class="fas fa-chart-line"></i> ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø§Ù„ÙŠ</h3>
            <div class="kpi-card" style="height: 300px; display: flex; align-items: center; justify-content: center;">
                <p style="color: #64748b;">[ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø§Ù„ØªÙƒØªÙŠÙƒÙŠØ© ]</p>
            </div>
        </div>
    </main>

    <!-- AI Side Panel -->
    <div id="ai-btn" onclick="toggleAI()">ğŸ§ </div>
    <div id="ai-drawer" class="ai-drawer">
        <div style="padding:25px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center;">
            <span style="font-weight:900; color:var(--accent); letter-spacing:1px;"><i class="fas fa-brain"></i> AI ANALYST</span>
            <i class="fas fa-times" onclick="toggleAI()" style="cursor:pointer; color:#64748b;"></i>
        </div>
        <div id="ai-chat" class="ai-chat-body">
            <div class="ai-msg bot">ØªØ­ÙŠØ§ØªÙŠ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù‚Ø§Ø¦Ø¯. Ø£Ù†Ø§ Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ. Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ØŒ Ù‡Ù„ ØªÙˆØ¯ Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©ØŸ</div>
        </div>
        <div class="ai-footer">
            <input type="text" id="ai-input" class="ai-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ø§Ù„ØªÙƒØªÙŠÙƒÙŠ...">
            <button onclick="askAI()" style="background:var(--accent); border:none; width:50px; border-radius:5px; cursor:pointer;"><i class="fas fa-chevron-left"></i></button>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION (USING YOUR KEY) ---
        const GEMINI_KEY = "AIzaSyAPWM-Ue8plkZqxkMn86Q0xwPWB6Cbczfw"; 

        const firebaseConfig = {
            apiKey: "AIzaSyB2J3KViN4aZYRJ43rYGFtwkmy-jZXBO6c",
            databaseURL: "https://yalla-scooter-pro-default-rtdb.firebaseio.com",
            projectId: "yalla-scooter-pro",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Clock
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('ar-EG');
        }, 1000);

        // --- 2. AUTH & NAV ---
        function login() {
            const p = document.getElementById('passInput').value;
            if(p === "1213" || p === "9924") {
                if(p === "9924") document.getElementById('adm-btn').style.display = "flex";
                document.getElementById('login-overlay').style.display = "none";
                syncData();
            } else {
                Swal.fire({icon:'error', title:'ACCESS DENIED', background:'#070d19', color:'#fff'});
            }
        }

        function nav(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('sec-'+id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // --- 3. CORE LOGIC (FIREBASE) ---
        function syncData() {
            const today = new Date().toISOString().split('T')[0];

            // Real-time Trips
            db.ref('active_trips').on('value', snap => {
                const cont = document.getElementById('fleet-container');
                const kpiActive = document.getElementById('kpi-active');
                cont.innerHTML = "";
                let count = 0;
                
                snap.forEach(t => {
                    count++;
                    const data = t.val();
                    const mins = Math.floor((Date.now() - data.start)/60000);
                    cont.innerHTML += `
                        <div class="scooter-card">
                            <div class="scooter-header">
                                <b style="letter-spacing:1px">${data.scooter}</b>
                                <span class="sys-status" style="font-size:10px">ON MISSION</span>
                            </div>
                            <div style="margin-bottom:15px;">
                                <small style="color:#64748b">Ø§Ù„Ø¹Ù…ÙŠÙ„:</small> <span style="font-weight:bold">${data.client}</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div class="timer-val">${mins}m</div>
                                <button onclick="endTrip('${t.key}', ${mins})" style="background:transparent; border:1px solid var(--danger); color:var(--danger); padding:5px 15px; cursor:pointer; font-weight:bold;">TERMINATE</button>
                            </div>
                        </div>
                    `;
                });
                kpiActive.innerText = count;
            });

            // Revenue Stats
            db.ref(`history/${today}`).on('value', snap => {
                let rev = 0;
                snap.forEach(c => rev += (c.val().total || 0));
                document.getElementById('kpi-rev').innerText = rev + " Ø¬";
            });
        }

        // --- 4. AI ANALYST (GEMINI) ---
        function toggleAI() {
            document.getElementById('ai-drawer').classList.toggle('open');
        }

        async function askAI() {
            const inp = document.getElementById('ai-input');
            const chat = document.getElementById('ai-chat');
            const q = inp.value; if(!q) return;

            chat.innerHTML += `<div class="ai-msg user">${q}</div>`;
            inp.value = "";
            chat.scrollTop = chat.scrollHeight;

            const rev = document.getElementById('kpi-rev').innerText;
            const context = `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ù†Ø¸Ø§Ù… ØªØ£Ø¬ÙŠØ± Ø³ÙƒÙˆØªØ±. Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…: ${rev}. Ø£Ø¬Ø¨ ÙƒØ®Ø¨ÙŠØ± Ù…Ø§Ù„ÙŠ ÙˆØªÙƒØªÙŠÙƒÙŠ Ø¨Ø§Ø®ØªØµØ§Ø± Ø´Ø¯ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ Ø¹Ù„Ù‰: ${q}`;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: context }] }] })
                });
                const d = await res.json();
                const reply = d.candidates[0].content.parts[0].text;
                chat.innerHTML += `<div class="ai-msg bot">${reply}</div>`;
            } catch(e) {
                chat.innerHTML += `<div class="ai-msg bot" style="color:var(--danger)">ERROR: CONNECTION FAILED</div>`;
            }
            chat.scrollTop = chat.scrollHeight;
        }

        // --- Popups ---
        function newTripPopup() {
            Swal.fire({
                title: 'ØªØ®ØµÙŠØµ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                html: '<input id="s_n" class="swal2-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø¯Ø© S-101"><input id="c_n" class="swal2-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">',
                background: '#070d19', color: '#fff', confirmButtonColor: '#00f2ea',
                preConfirm: () => {
                    const s = document.getElementById('s_n').value;
                    const c = document.getElementById('c_n').value;
                    if(s) db.ref('active_trips').push({ scooter: s.toUpperCase(), client: c||"Unknown", start: Date.now() });
                }
            });
        }

        function endTrip(key, mins) {
            const total = mins * 1.5; // ØªØ³Ø¹ÙŠØ±Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
            Swal.fire({
                title: 'Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©',
                text: `Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©: ${total} Ø¬.Ù…`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ØµÙŠÙ„',
                background: '#070d19', color: '#fff', confirmButtonColor: '#00f2ea'
            }).then(r => {
                if(r.isConfirmed) {
                    const today = new Date().toISOString().split('T')[0];
                    db.ref(`history/${today}`).push({ total, mins, end: Date.now() });
                    db.ref('active_trips/'+key).remove();
                }
            });
        }

    </script>
</body>
</html>
