// --- ููุทู ุญูุงูุฉ ุงูุจุทุงุฑูุฉ (ููุถุงู ุฏุงุฎู ุฏุงูุฉ ุจุฏุก ุฑุญูุฉ ุฌุฏูุฏุฉ) ---
async function startSecureTrip(scooterId, startBat) {
    // 1. ุฌูุจ ุขุฎุฑ ุญุงูุฉ ูุณุฌูุฉ ููุณููุชุฑ
    const lastStatus = await db.ref(`scooters_status/${scooterId}`).once('value');
    const lastBat = lastStatus.val()?.lastBattery || 100;

    // 2. ุงูุชุญูู ูู ูุฌูุฏ ูุฌูุฉ (Gap)
    const gap = lastBat - startBat;
    if (gap > 5) { // ูู ูู ููุต ุฃูุซุฑ ูู 5% ุจุฏูู ุดุญู ุฃู ุฑุญูุฉ
        sendTG(`๐จ <b>ุชูุจูู ุชูุงุนุจ ูุญุชูู!</b>\n๐ต ุณููุชุฑ: ${scooterId}\n๐ ูุฌูุฉ ุจุทุงุฑูุฉ: ${gap}%\nุงูุณููุชุฑ ุชุฑู ุงููุญู ุจู ${lastBat}% ูููุชุญ ุงูุขู ุจู ${startBat}%\nูุฑุฌู ูุฑุงุฌุนุฉ ุงูููุธู ููุฑุงู!`);
    }

    // 3. ุจุฏุก ุงูุฑุญูุฉ ุงูุนุงุฏูุฉ
    db.ref('active_trips').push({ 
        scooter: scooterId, 
        startBattery: startBat, 
        startTime: Date.now(),
        status: 'active' 
    });
}

// --- ููุทู ุงูุชุญุฏูุซ ุนูุฏ ุงูุฅููุงุก (ููุถุงู ุฏุงุฎู ุฏุงูุฉ terminateTrip) ---
function endSecureTrip(scooterId, endBat) {
    // ุชุญุฏูุซ "ุขุฎุฑ ุญุงูุฉ ูุนุฑููุฉ" ููุจุทุงุฑูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    db.ref(`scooters_status/${scooterId}`).update({
        lastBattery: endBat,
        lastUsed: Date.now()
    });
}

// --- ูุธููุฉ ุงูุฌุฑุฏ ุงูููุงุฌุฆ (Audit) ---
async function fleetAudit() {
    const { value: bat } = await Swal.fire({
        title: 'ุฌุฑุฏ ุงูุจุทุงุฑูุงุช ุงูุขู',
        input: 'number',
        inputLabel: 'ุฃุฏุฎู ุจุทุงุฑูุฉ ุงูุณููุชุฑ S-01 ุงูุญุงููุฉ',
        // ูููู ุชูุฑุงุฑูุง ููู ุงูุณููุชุฑุงุช
    });
    // ุงููุธุงู ููุงุฑู ููุจุญุซ ุนู ูุฌูุงุช
}
