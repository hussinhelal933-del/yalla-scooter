<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yalla Scooter | الإصدار الرسمي</title>
    
    <!-- الموارد الأساسية -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Rajdhani:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --yalla-blue: #39b5e0;
            --rabbit-green: #8ed254;
            --text-dark: #1a1a1a;
            --gray-light: #f4f4f4;
            --border-color: #eee;
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: white; }

        /* --- شاشة الدخول (Auth) --- */
        #auth-overlay { position: fixed; inset: 0; background: white; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .auth-card { width: 85%; text-align: center; }
        .btn-auth { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 10px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; background: white; font-size: 16px; }
        .btn-phone { background: var(--rabbit-green); color: white; border: none; }

        /* --- الخريطة (ستايل رابيت الهادئ) --- */
        #map { position: absolute; inset: 0; z-index: 1; filter: grayscale(0.2) contrast(1.1); }

        /* --- القائمة الجانبية (Side Menu) --- */
        #side-menu {
            position: fixed; top: 0; right: -100%; width: 80%; height: 100%;
            background: white; z-index: 5000; transition: 0.3s ease-out;
            padding: 50px 25px; display: flex; flex-direction: column;
        }
        #side-menu.open { right: 0; }
        .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 4999; display: none; }

        .user-profile { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .profile-logo { width: 55px; height: 55px; background: #f9f9f9; border-radius: 15px; display: flex; align-items: center; justify-content: center; }
        .user-meta b { font-size: 20px; display: block; color: var(--text-dark); }
        .user-meta span { font-size: 14px; color: #888; }

        .prime-badge {
            background: white; border: 2px solid var(--rabbit-green); color: var(--rabbit-green);
            padding: 10px; border-radius: 12px; font-weight: 900; text-align: center;
            display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 30px;
        }

        .menu-item { display: flex; align-items: center; gap: 20px; padding: 18px 0; color: #333; font-weight: 600; border-bottom: 1px solid #f9f9f9; cursor: pointer; }
        .menu-item i { color: #888; font-size: 20px; width: 25px; }

        /* --- الأزرار العائمة (Floating HUD) --- */
        .hud { position: absolute; inset: 0; pointer-events: none; z-index: 1000; }
        .hud button { pointer-events: auto; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

        .btn-circle { width: 55px; height: 55px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; position: absolute; bottom: 35px; }
        .btn-menu { right: 25px; }
        .btn-locate { left: 25px; }
        .btn-scan {
            position: absolute; bottom: 35px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(to right, #8ed254, #b2e672);
            color: white; padding: 15px 40px; border-radius: 50px;
            font-weight: 900; font-size: 18px; width: 220px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        /* --- أيقونة السكوتر (لوجو Y) --- */
        .scooter-marker { background: none; border: none; }
        .scooter-pin { 
            width: 42px; height: 42px; background: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2); border: 2px solid var(--rabbit-green);
        }

        /* --- SVG Logo --- */
        .yalla-logo { width: 120px; margin-bottom: 20px; }
        .y-icon { width: 30px; height: auto; }
    </style>
</head>
<body>

    <!-- 1. شاشة الدخول -->
    <div id="auth-overlay">
        <div class="auth-card">
            <!-- اللوجو رقم 1 (عالي الدقة) -->
            <svg class="yalla-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 20 L40 50 L40 85 M40 50 L60 20" stroke="#39b5e0" stroke-width="10" fill="none" stroke-linecap="round"/>
                <circle cx="40" cy="85" r="8" fill="#333"/>
                <line x1="10" y1="30" x2="25" y2="30" stroke="#39b5e0" stroke-width="5" stroke-linecap="round" />
                <line x1="5" y1="45" x2="20" y2="45" stroke="#39b5e0" stroke-width="5" stroke-linecap="round" />
            </svg>
            <h2 style="font-family:'Rajdhani'; letter-spacing:2px; margin-bottom:40px;">YALLA SCOOTER</h2>
            
            <button onclick="loginPhone()" class="btn-auth btn-phone"><i class="fas fa-phone"></i> رقم الهاتف</button>
            <button onclick="loginGoogle()" class="btn-auth"><img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="18"> متابعة باستخدام Google</button>
        </div>
    </div>

    <!-- 2. القائمة الجانبية -->
    <div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
    <nav id="side-menu">
        <div class="user-profile">
            <div class="profile-logo">
                <svg class="y-icon" viewBox="0 0 100 100">
                    <path d="M20 20 L40 50 L40 85 M40 50 L60 20" stroke="#8ed254" stroke-width="12" fill="none" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="user-meta">
                <b id="u-name">Hassan</b>
                <span id="u-phone">+201153243863</span>
            </div>
        </div>

        <div class="prime-badge"><i class="fas fa-star"></i> Free Yalla Prime</div>

        <div class="menu-list">
            <div class="menu-item"><i class="fas fa-history"></i> History</div>
            <div class="menu-item" onclick="openWallet()"><i class="fas fa-wallet"></i> Wallet</div>
            <div class="menu-item"><i class="fas fa-gift"></i> Free Balance</div>
            <div class="menu-item"><i class="fas fa-motorcycle"></i> How To Ride</div>
            <div class="menu-item"><i class="fas fa-calendar-alt"></i> Day Rentals</div>
            <div class="menu-item"><i class="fas fa-language"></i> Language / اللغة</div>
        </div>

        <div class="menu-item" onclick="logout()" style="margin-top:auto; color:red; border:none;">
            <i class="fas fa-sign-out-alt" style="color:red;"></i> Logout
        </div>
    </nav>

    <!-- 3. الخريطة -->
    <div id="map"></div>

    <!-- 4. الأزرار العائمة (HUD) -->
    <div class="hud">
        <button class="btn-circle btn-menu" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
        <button class="btn-scan" onclick="startRide()"><i class="fas fa-expand"></i> Scan to Ride</button>
        <button class="btn-circle btn-locate" onclick="locate()"><i class="fas fa-crosshairs"></i></button>
    </div>

<script>
    // --- إعدادات Firebase ---
    const firebaseConfig = { databaseURL: "https://yalla-scooter-pro-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let map, scooterMarkers = {};
    let user = JSON.parse(localStorage.getItem('yalla_user')) || null;

    window.onload = () => {
        if(user) {
            document.getElementById('auth-overlay').style.display = 'none';
            document.getElementById('u-name').innerText = user.displayName || "عميل يلا";
            document.getElementById('u-phone').innerText = user.phoneNumber || user.email;
            initApp();
        }
    };

    // --- تسجيل الدخول ---
    function loginGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithPopup(provider).then(res => {
            localStorage.setItem('yalla_user', JSON.stringify(res.user));
            location.reload();
        });
    }

    function loginPhone() {
        Swal.fire({
            title: 'رقم الهاتف',
            input: 'tel',
            inputPlaceholder: '01xxxxxxxxx',
            confirmButtonColor: '#8ed254'
        }).then(res => {
            if(res.value) {
                const fakeUser = { displayName: 'Hassan', phoneNumber: res.value };
                localStorage.setItem('yalla_user', JSON.stringify(fakeUser));
                location.reload();
            }
        });
    }

    // --- تشغيل التطبيق والخرائط ---
    function initApp() {
        map = L.map('map', { zoomControl: false, attributionControl: false }).setView([30.0444, 31.2357], 16);
        
        // ستايل الخريطة الفاتح (Rabbit Style)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        // جلب السكوترات المتاحة
        db.ref('live_nodes').on('value', snap => {
            snap.forEach(child => {
                const d = child.val();
                if(!scooterMarkers[child.key]) {
                    const icon = L.divIcon({
                        className: 'scooter-marker',
                        html: `<div class="scooter-pin">
                                <svg width="22" height="22" viewBox="0 0 100 100">
                                    <path d="M20 20 L40 50 L40 85 M40 50 L60 20" stroke="#8ed254" stroke-width="15" fill="none" stroke-linecap="round"/>
                                </svg>
                               </div>`
                    });
                    scooterMarkers[child.key] = L.marker([d.lat, d.lon], {icon}).addTo(map);
                } else {
                    scooterMarkers[child.key].setLatLng([d.lat, d.lon]);
                }
            });
        });
        locate();
    }

    // --- التحكم بالواجهة ---
    function toggleMenu() {
        const m = document.getElementById('side-menu');
        const o = document.getElementById('overlay');
        const isOpen = m.classList.toggle('open');
        o.style.display = isOpen ? 'block' : 'none';
    }

    function locate() {
        if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                map.flyTo([pos.coords.latitude, pos.coords.longitude], 17);
            });
        }
    }

    async function startRide() {
        const { value: scId } = await Swal.fire({
            title: 'Scan QR Code',
            input: 'text',
            inputPlaceholder: 'أدخل رقم السكوتر',
            confirmButtonText: 'ابدأ الرحلة',
            confirmButtonColor: '#8ed254'
        });
        if(scId) {
            db.ref('active_trips').push({ 
                phone: user.phoneNumber || user.email, 
                scooterId: scId, 
                start: Date.now() 
            });
            Swal.fire('تم بدء الرحلة', 'انطلق بأمان واستمتع بيومك', 'success');
        }
    }

    function openWallet() {
        Swal.fire({
            title: 'المحفظة',
            html: '<h1 style="color:#8ed254">0.00 ج.م</h1><p>رصيدك الحالي غير كافٍ لشحن باقة Prime</p>',
            confirmButtonText: 'شحن رصيد',
            confirmButtonColor: '#8ed254'
        });
    }

    function logout() { localStorage.clear(); location.reload(); }
</script>

</body>
</html>
