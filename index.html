<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Scooter Phone System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
body{margin:0;font-family:Cairo;background:#000;color:#fff}
header{padding:15px;background:#050505;color:#00ffcc;font-weight:bold}
section{padding:15px}
.card{background:#0d1117;border:1px solid #00ffcc33;border-radius:15px;padding:15px;margin-bottom:15px}
input,button{width:100%;padding:14px;border-radius:12px;border:none;margin-top:10px;font-size:16px}
button{background:#00ffcc;color:#000;font-weight:bold}
.locked{color:#ff5555}
.unlocked{color:#00ff55}
.small{font-size:12px;color:#aaa}
</style>
</head>
<body>

<header>ğŸ›µ Scooter Phone Controller</header>

<section>

<div class="card">
<b>ğŸ” Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙƒÙˆØªØ±:</b>
<div id="status" class="locked">Ù…Ù‚ÙÙˆÙ„</div>
<input type="password" id="pin" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ÙØªØ­">
<button onclick="unlock()">ÙØªØ­ Ø§Ù„Ø³ÙƒÙˆØªØ±</button>
<button onclick="endTrip()">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</button>
</div>

<div class="card">
<b>ğŸ“ GPS</b>
<div id="gps" class="small">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø©...</div>
</div>

<div class="card">
<b>ğŸš€ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</b>
<div id="trip" class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø­Ù„Ø©</div>
</div>

<div class="card">
<b>ğŸ“œ Events</b>
<div id="events"></div>
</div>

</section>

<script>
/* ========== CONFIG ========== */
const NODE_ID = "SCOOTER-001";
const UNLOCK_PIN = "1214";

/* ========== FIREBASE ========== */
firebase.initializeApp({
  databaseURL: "PUT_YOUR_DATABASE_URL_HERE"
});
const db = firebase.database();

/* ========== STATE ========== */
let tripActive = false;

/* ========== UNLOCK ========== */
function unlock(){
  const pin = document.getElementById("pin").value;
  if(pin !== UNLOCK_PIN){
    logEvent("PIN_FAIL");
    alert("ÙƒÙˆØ¯ ØºÙ„Ø· âŒ");
    return;
  }

  db.ref("active_trips/"+NODE_ID).set({
    start: Date.now()
  });

  tripActive = true;
  updateStatus();
  logEvent("PIN_SUCCESS");
}

/* ========== END TRIP ========== */
function endTrip(){
  db.ref("active_trips/"+NODE_ID).remove();
  tripActive = false;
  updateStatus();
  logEvent("TRIP_ENDED");
}

/* ========== STATUS UI ========== */
function updateStatus(){
  const el = document.getElementById("status");
  if(tripActive){
    el.innerText = "Ù…ÙØªÙˆØ­ (Ø±Ø­Ù„Ø© Ø´ØºØ§Ù„Ø©)";
    el.className = "unlocked";
  }else{
    el.innerText = "Ù…Ù‚ÙÙˆÙ„";
    el.className = "locked";
  }
}

/* ========== GPS TRACKING ========== */
if("geolocation" in navigator){
  navigator.geolocation.watchPosition(pos=>{
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const speed = pos.coords.speed || 0;

    document.getElementById("gps").innerText =
      `Lat: ${lat.toFixed(5)} | Lon: ${lon.toFixed(5)} | Speed: ${Math.round(speed*3.6)} km/h`;

    db.ref("nodes/"+NODE_ID).set({
      lat, lon,
      speed: Math.round(speed*3.6),
      last: Date.now()
    });

    runRules(speed);

  },err=>{
    document.getElementById("gps").innerText="GPS ØºÙŠØ± Ù…ØªØ§Ø­";
  },{
    enableHighAccuracy:true,
    maximumAge:2000
  });
}

/* ========== RULE ENGINE ========== */
function runRules(speed){
  if(speed > 3 && !tripActive){
    logEvent("MOVEMENT_WITHOUT_TRIP");
  }
}

/* ========== EVENTS ========== */
function logEvent(type){
  db.ref("events").push({
    type,
    node: NODE_ID,
    ts: Date.now()
  });
}

/* ========== LIVE TRIP STATE ========== */
db.ref("active_trips/"+NODE_ID).on("value",s=>{
  tripActive = s.exists();
  document.getElementById("trip").innerText =
    tripActive ? "ğŸš´ Ø±Ø­Ù„Ø© Ø´ØºØ§Ù„Ø©" : "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø­Ù„Ø©";
  updateStatus();
});

/* ========== EVENTS UI ========== */
db.ref("events").limitToLast(6).on("value",s=>{
  let html="";
  s.forEach(e=>{
    html+=`<div class="small">â€¢ ${e.val().type}</div>`;
  });
  document.getElementById("events").innerHTML=html;
});
</script>

</body>
</html>
