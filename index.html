<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yalla Scooter | Official App</title>
    
    <!-- Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --rabbit-green: #8ed254;
            --yalla-blue: #39b5e0;
            --text-main: #1a1a1a;
            --gray-bg: #f7f7f7;
            --border: #eeeeee;
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: white; color: var(--text-main); }

        /* --- Ø´Ø§Ø´Ø§Øª ÙƒØ§Ù…Ù„Ø© (Full Screens) --- */
        .page { position: fixed; inset: 0; background: white; z-index: 6000; display: none; flex-direction: column; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        
        .header { padding: 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); font-weight: 700; font-size: 18px; }
        .back-icon { font-size: 22px; cursor: pointer; }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ --- */
        #auth-screen { position: fixed; inset: 0; background: white; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; }
        .auth-logo { width: 120px; margin-bottom: 20px; }
        .auth-input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 15px; text-align: center; font-size: 18px; }

        /* --- Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© --- */
        #map { position: absolute; inset: 0; z-index: 1; filter: grayscale(0.5) brightness(1.05); }
        .hud-btn { position: absolute; z-index: 1000; background: white; border: none; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; }
        .btn-menu { bottom: 40px; right: 25px; }
        .btn-locate { bottom: 40px; left: 25px; }
        .btn-help { top: 60px; right: 25px; width: 45px; height: 45px; }
        .btn-scan { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); background: var(--rabbit-green); color: white; padding: 15px 40px; border-radius: 50px; font-weight: 900; width: 220px; z-index: 1000; display: flex; align-items: center; justify-content: center; gap: 10px; border: none; box-shadow: 0 5px 20px rgba(142, 210, 84, 0.4); }

        /* --- Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ --- */
        #side-menu { position: fixed; top: 0; right: -100%; width: 85%; height: 100%; background: white; z-index: 5000; transition: 0.3s; padding: 50px 25px; }
        #side-menu.open { right: 0; }
        .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 4999; display: none; }
        .profile-section { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .prime-btn { border: 2px solid var(--rabbit-green); color: var(--rabbit-green); padding: 12px; border-radius: 12px; text-align: center; font-weight: 900; margin-bottom: 30px; cursor: pointer; }

        /* --- Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆØ§Ù„Ø´Ø­Ù† --- */
        .balance-card { background: var(--gray-bg); margin: 20px; padding: 25px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; }
        .recharge-btn { background: var(--rabbit-green); color: white; padding: 8px 20px; border-radius: 10px; font-weight: bold; border: none; }
        .package-item { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .radio-circle { width: 22px; height: 22px; border: 2px solid #ddd; border-radius: 50%; }
        .package-item.selected .radio-circle { border-color: var(--rabbit-green); background: radial-gradient(var(--rabbit-green) 50%, white 50%); }

        /* --- Ø³Ø¬Ù„ Ø§Ù„Ø±Ø­Ù„Ø§Øª --- */
        .tabs { display: flex; background: var(--gray-bg); margin: 20px; border-radius: 50px; padding: 5px; }
        .tab { flex: 1; text-align: center; padding: 10px; border-radius: 50px; font-weight: 700; color: #888; }
        .tab.active { background: white; color: var(--rabbit-green); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .history-item { margin: 0 20px; padding: 20px 0; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }

        /* --- Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±ÙƒÙˆØ¨ (Guide) --- */
        .guide-step { position: absolute; inset: 0; background-size: cover; background-position: center; display: none; padding: 40px; flex-direction: column; justify-content: flex-end; color: white; }
        .guide-step::after { content: ''; position: absolute; inset: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); z-index: 1; }
        .guide-content { z-index: 2; position: relative; }
        .step-bar { display: flex; gap: 5px; position: absolute; top: 60px; width: calc(100% - 80px); }
        .bar-segment { height: 4px; flex: 1; background: rgba(255,255,255,0.3); border-radius: 10px; }
        .bar-segment.active { background: white; }
    </style>
</head>
<body>

    <!-- 1. Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="auth-screen">
        <svg class="auth-logo" viewBox="0 0 100 100">
            <path d="M20 20 L40 50 L40 85 M40 50 L60 20" stroke="#39b5e0" stroke-width="12" fill="none" stroke-linecap="round"/>
            <circle cx="40" cy="85" r="8" fill="#1a1a1a"/>
        </svg>
        <h2 style="font-weight:900; letter-spacing:1px; margin-bottom:40px;">YALLA SCOOTER</h2>
        <input type="tel" id="authPhone" class="auth-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        <input type="email" id="authEmail" class="auth-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <button onclick="login()" class="btn-scan" style="position:static; transform:none; width:100%; margin-top:10px;">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <!-- 2. Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
    <nav id="side-menu">
        <div class="profile-section">
            <div style="width:55px; height:55px; background:var(--gray-bg); border-radius:15px; display:flex; align-items:center; justify-content:center;">
                <svg width="30" viewBox="0 0 100 100"><path d="M20 20 L40 50 L40 85 M40 50 L60 20" stroke="#8ed254" stroke-width="12" fill="none" stroke-linecap="round"/></svg>
            </div>
            <div><b id="uName">Hassan</b><br><small id="uPhone">+201153243863</small></div>
        </div>
        <div class="prime-btn">Free Yalla Prime Plus <i class="fas fa-star"></i></div>
        <div class="menu-list">
            <div class="menu-item" onclick="openPage('history')"><i class="fas fa-history"></i> History</div>
            <div class="menu-item" onclick="openPage('wallet')"><i class="fas fa-wallet"></i> Wallet</div>
            <div class="menu-item"><i class="fas fa-gift"></i> Free Balance</div>
            <div class="menu-item" onclick="openPage('guide')"><i class="fas fa-motorcycle"></i> How To Ride</div>
            <div class="menu-item"><i class="fas fa-calendar-alt"></i> Day Rentals</div>
            <div class="menu-item"><i class="fas fa-language"></i> Language / Ø§Ù„Ù„ØºØ©</div>
        </div>
    </nav>

    <!-- 3. Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="map"></div>
    <button class="hud-btn btn-help" onclick="openPage('support')"><i class="fas fa-comment-dots"></i></button>
    <button class="hud-btn btn-menu" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
    <button class="hud-btn btn-locate" onclick="locate()"><i class="fas fa-crosshairs"></i></button>
    <button class="btn-scan" onclick="openPage('guide')">
        <i class="fas fa-expand"></i> Ø³ÙƒØ§Ù† ÙˆØ¥Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©
    </button>

    <!-- 4. Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© (Wallet) -->
    <div id="page-wallet" class="page">
        <div class="header"><i class="fas fa-chevron-left back-icon" onclick="closePage('wallet')"></i> Ù…Ø­ÙØ¸Ø© <i></i></div>
        <div class="balance-card">
            <div><small>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</small><h2 id="balance-val">915.33 Ø¬.Ù…</h2></div>
            <button class="recharge-btn" onclick="openPage('recharge')">Ø¥Ø´Ø­Ù†</button>
        </div>
        <div style="padding:20px;">
            <p><b>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</b></p>
            <p style="color:var(--rabbit-green)"><i class="fas fa-plus-circle"></i> Ø§Ø¶Ù ÙƒØ§Ø±Øª</p>
            <p style="margin-top:40px;"><b>Ø¶ÙŠÙ Ø§Ù„Ø¨Ø±ÙˆÙ…ÙˆÙƒÙˆØ¯</b></p>
            <div style="display:flex; gap:10px;"><input type="text" placeholder="Ø¨Ø±ÙˆÙ…ÙˆÙƒÙˆØ¯" style="flex:1; padding:12px; border:none; background:var(--gray-bg); border-radius:10px;"><button style="background:none; border:none; color:#ccc; font-weight:bold;">ØªÙØ¹ÙŠÙ„</button></div>
        </div>
    </div>

    <!-- 5. Ø´Ø§Ø´Ø© Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø´Ø­Ù† (Recharge) -->
    <div id="page-recharge" class="page">
        <div class="header"><i class="fas fa-chevron-left back-icon" onclick="closePage('recharge')"></i> Ø¥Ø´Ø­Ù† <i></i></div>
        <div style="padding:20px;">
            <p><b>Ø§Ø®ØªØ§Ø± Ø¨Ø§Ù‚Ø© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù„ÙŠ ØªÙ†Ø§Ø³Ø¨Ùƒ</b></p>
            <div class="package-item selected"><span>50 Ø±ØµÙŠØ¯</span><b>50 Ø¬.Ù…</b><div class="radio-circle"></div></div>
            <div class="package-item"><span>100 Ø±ØµÙŠØ¯</span><b>100 Ø¬.Ù…</b><div class="radio-circle"></div></div>
            <div class="package-item"><span>200 Ø±ØµÙŠØ¯</span><b>200 Ø¬.Ù…</b><div class="radio-circle"></div></div>
            <div class="package-item"><span>300 Ø±ØµÙŠØ¯</span><b>300 Ø¬.Ù…</b><div class="radio-circle"></div></div>
        </div>
        <button class="btn-scan" style="position:static; margin:auto; width:90%; transform:none;">Ø¥Ø´Ø­Ù†</button>
    </div>

    <!-- 6. Ø´Ø§Ø´Ø© Ø³Ø¬Ù„ Ø§Ù„Ø±Ø­Ù„Ø§Øª (History) -->
    <div id="page-history" class="page">
        <div class="header"><i class="fas fa-chevron-left back-icon" onclick="closePage('history')"></i> Ø±Ø­Ù„Ø§ØªÙŠ <i></i></div>
        <div class="tabs"><div class="tab active">Ø±Ø­Ù„Ø§ØªÙƒ</div><div class="tab">Ø¥ÙŠØ¬Ø§Ø±Ø§ØªÙƒ</div><div class="tab">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div></div>
        <div class="history-item">
            <div><span style="background:var(--rabbit-green); color:white; padding:2px 10px; border-radius:20px; font-size:12px;">s7zet</span> <b>Yalla - S</b><br><small>13 ÙŠÙ†Ø§ÙŠØ±ØŒ 2026</small></div>
            <div style="text-align:left"><b>40.00 Ø¬.Ù…</b></div>
        </div>
    </div>

    <!-- 7. Ø´Ø§Ø´Ø© Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±ÙƒÙˆØ¨ (Ride Guide) -->
    <div id="page-guide" class="page" style="z-index:7000;">
        <div class="step-bar" id="guide-bars"></div>
        <!-- Steps -->
        <div id="step-1" class="guide-step active" style="display:flex; background-image:url('https://images.unsplash.com/photo-1558981403-c5f9199a28bd?auto=format&fit=crop&q=80&w=1000');">
            <div class="guide-content"><h1>1. Ø­Ø¯Ø¯ Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ğŸ“</h1><p>Ø¯ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù‚Ø±Ø¨ Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„ Ù…Ù†Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©.</p></div>
        </div>
        <div id="step-2" class="guide-step" style="background-image:url('https://images.unsplash.com/photo-1600132806370-bf17e65e942f?auto=format&fit=crop&q=80&w=1000');">
            <div class="guide-content"><h1>2. Ø³ÙƒØ§Ù† Ø§Ù„Ù€ QR ÙƒÙˆØ¯ ğŸ”’</h1><p>Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø¨Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø².</p></div>
        </div>
        <div id="step-3" class="guide-step" style="background-image:url('https://images.unsplash.com/photo-1519608487913-d9d9b90083cc?auto=format&fit=crop&q=80&w=1000');">
            <div class="guide-content"><h1>3. Ø¬Ø§Ù‡Ø² ØªØ¨Ø¯Ø£ØŸ ğŸ‘Œ</h1><p>Ø§Ø±ÙØ¹ Ø§Ù„Ø³Ù†Ø§Ø¯Ø© ÙˆØ§Ù†Ø·Ù„Ù‚ Ø¨Ù‚ÙˆØ©.</p><button class="btn-scan" onclick="startRideNow()" style="position:static; width:100%; transform:none; margin-top:20px;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©</button></div>
        </div>
        <div style="position:absolute; bottom:30px; left:20px; right:20px; display:flex; gap:10px; z-index:5;">
            <button onclick="closePage('guide')" style="flex:1; padding:15px; border-radius:15px; border:none; background:rgba(255,255,255,0.2); color:white;">Ø¥Ù„ØºØ§Ø¡</button>
            <button id="next-step-btn" onclick="nextStep()" style="flex:1; padding:15px; border-radius:15px; border:none; background:var(--rabbit-green); color:white;">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
    </div>

<script>
    // --- Ø§Ù„Ø±Ø¨Ø· Ø¨Ù€ Firebase ---
    const firebaseConfig = { databaseURL: "https://yalla-scooter-pro-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let map, currentStep = 1, userPhone = localStorage.getItem('y_phone');

    window.onload = () => { if(userPhone) { document.getElementById('auth-screen').style.display='none'; initApp(); } };

    function login() {
        const ph = document.getElementById('authPhone').value;
        if(ph.length < 11) return Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§Ù…Ù„Ø©', 'error');
        userPhone = ph; localStorage.setItem('y_phone', ph);
        location.reload();
    }

    function initApp() {
        map = L.map('map', { zoomControl: false, attributionControl: false }).setView([30.0444, 31.2357], 16);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
        
        // Ù…Ø§Ø±ÙƒØ±Ø§Øª Ø§Ù„Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„Ø§Øª (Ø¨Ø§Ù„Ù„ÙˆØ¬Ùˆ Y)
        db.ref('live_nodes').on('value', snap => {
            snap.forEach(c => {
                const icon = L.divIcon({ className:'m', html:`<div style="width:40px; height:40px; background:white; border-radius:50%; border:2px solid #8ed254; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 10px rgba(0,0,0,0.2)"><svg width="20" viewBox="0 0 100 100"><path d="M20 20 L40 50 L40 85 M40 50 L60 20" stroke="#8ed254" stroke-width="15" fill="none" stroke-linecap="round"/></svg></div>` });
                L.marker([c.val().lat, c.val().lon], {icon}).addTo(map);
            });
        });
        document.getElementById('uPhone').innerText = userPhone;
    }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø¨ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª ---
    function openPage(id) { document.getElementById('page-'+id).style.display='flex'; if(id==='guide') initGuide(); }
    function closePage(id) { document.getElementById('page-'+id).style.display='none'; }
    function toggleMenu() { const m=document.getElementById('side-menu'); m.classList.toggle('open'); document.getElementById('overlay').style.display=m.classList.contains('open')?'block':'none'; }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ù„ÙŠÙ„ (Onboarding) ---
    function initGuide() {
        currentStep = 1; showStep(1);
        const bars = document.getElementById('guide-bars'); bars.innerHTML = '';
        for(let i=1; i<=3; i++) bars.innerHTML += `<div class="bar-segment" id="bar-${i}"></div>`;
        document.getElementById('bar-1').classList.add('active');
    }
    function nextStep() { if(currentStep < 3) { currentStep++; showStep(currentStep); } }
    function showStep(n) {
        document.querySelectorAll('.guide-step').forEach(s => s.style.display='none');
        document.getElementById('step-'+n).style.display='flex';
        document.querySelectorAll('.bar-segment').forEach((b, i) => b.classList.toggle('active', i < n));
        document.getElementById('next-step-btn').style.display = n === 3 ? 'none' : 'block';
    }

    function startRideNow() {
        Swal.fire({ title:'Scan QR', input:'text', confirmButtonColor:'#8ed254' }).then(res => {
            if(res.value) { db.ref('active_trips').push({ phone: userPhone, scooterId: res.value, start: Date.now() }); closePage('guide'); Swal.fire('Ø±Ø­Ù„Ø© Ø³Ø¹ÙŠØ¯Ø©!'); }
        });
    }

    function locate() { if(navigator.geolocation) navigator.geolocation.getCurrentPosition(p => map.flyTo([p.coords.latitude, p.coords.longitude], 17)); }
</script>
</body>
</html>
