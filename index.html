<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yalla Scooter | Cyber Hub V100</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --blue: #00f2ff; --bg: #000; --card: #0a0a0a; --red: #ff0055; --green: #0aff60; --border: rgba(0, 242, 255, 0.1); }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; margin:0; padding:0; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .hidden { display: none !important; }

        /* Header */
        header { height: 60px; background: #050505; border-bottom: 1px solid #111; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; }
        h1 { color: var(--blue); font-size: 22px; font-weight: 900; }

        /* Content */
        .app-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 50px; }
        .section { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 15px; }
        
        /* Stats */
        .kpi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .kpi-card { background: #080808; border: 1px solid #222; padding: 12px; border-radius: 15px; text-align: center; }
        .kpi-val { font-family: 'Rajdhani'; font-size: 22px; color: var(--blue); font-weight: 700; }

        /* Input */
        input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 10px; margin-bottom: 10px; text-align: center; font-size: 16px; }
        button { cursor: pointer; border: none; border-radius: 12px; font-weight: bold; padding: 14px; transition: 0.2s; font-size: 15px; width: 100%; }
        .btn-blue { background: var(--blue); color: #000; }
        .btn-danger { background: rgba(255,0,85,0.1); color: var(--red); border: 1px solid var(--red); }
        .btn-now { background: #111; color: var(--blue); font-size: 10px; padding: 5px; margin-top: -5px; margin-bottom: 10px; }

        /* Trip Card */
        .trip-card { background: #0c0c0c; border: 1px solid #222; border-radius: 18px; padding: 15px; margin-bottom: 10px; border-right: 4px solid var(--blue); }
        .timer { font-family: 'Rajdhani'; font-size: 30px; color: var(--blue); text-align: center; margin: 5px 0; }

        /* Login */
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-screen">
        <h1 style="font-family:'Rajdhani'; font-size: 35px; margin-bottom: 20px;">YALLA COMMAND</h1>
        <input type="password" id="pinCode" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯">
        <button onclick="App.login()" class="btn-blue" style="width:80%">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
    <header id="header" class="hidden">
        <h1 id="user-label">YALLA HUB</h1>
        <div id="clock" style="font-family:'Rajdhani'; color:#666; font-size:12px;">00:00:00</div>
    </header>

    <main id="main" class="app-content hidden">
        
        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· -->
        <div id="admin-stats" class="kpi-grid hidden">
            <div class="kpi-card"><small>Ø§Ù„Ø¯Ø±Ø¬</small><br><span id="vault" class="kpi-val">0</span></div>
            <div class="kpi-card"><small>Ù†Ø´Ø·</small><br><span id="active-count" class="kpi-val">0</span></div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
        <div class="section">
            <label style="color:var(--blue); font-weight:bold; font-size:12px;">Ø¨Ø¯Ø¡ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©:</label>
            <input type="text" id="cust" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
            <input type="text" id="scoot" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ±">
            
            <label>ğŸªª ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>
            <input type="file" accept="image/*" capture="camera" onchange="App.handleImg(this)">
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div><label style="font-size:10px">Ø®Ø±ÙˆØ¬</label><input type="time" id="t1"><button class="btn-now" onclick="App.setT('t1')">Ø§Ù„Ø¢Ù†</button></div>
                <div><label style="font-size:10px">Ø±Ø¬ÙˆØ¹</label><input type="time" id="t2"><button class="btn-now" onclick="App.setT('t2')">Ø§Ù„Ø¢Ù†</button></div>
            </div>
            <button class="btn-blue" onclick="App.saveTrip(false)">ğŸš€ Ø¨Ø¯Ø¡ / Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø­Ù„Ø©</button>
            <button class="btn-danger" style="margin-top:10px;" onclick="App.saveTrip(true)">ğŸš¨ Ø¹Ø·Ù„ ÙÙ†ÙŠ ÙˆØ®ØµÙ…</button>
        </div>

        <!-- Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ© Ø§Ù„Ø¢Ù† -->
        <h3 style="margin-bottom:10px; font-size:15px; color:var(--blue)">ğŸ›µ Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ©:</h3>
        <div id="active-trips-list"></div>

        <hr style="border:0; border-top:1px solid #222; margin:20px 0;">

        <!-- Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆØ§Ù„Ø¨Ø­Ø« -->
        <div class="section">
            <label>ğŸ” Ø¨Ø­Ø« Ø£Ø¯Ø§Ø¡ Ø³ÙƒÙˆØªØ± Ù…Ø¹ÙŠÙ†:</label>
            <input type="text" id="search" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ±" oninput="App.filter()">
            <div class="kpi-grid" style="margin-top:10px">
                <div class="kpi-card"><small>Ø¯Ù‚Ø§Ø¦Ù‚</small><br><span id="st-mins" class="kpi-val">0</span></div>
                <div class="kpi-card"><small>Ø£Ø±Ø¨Ø§Ø­</small><br><span id="st-cash" class="kpi-val">0</span></div>
            </div>
        </div>

        <input type="date" id="archive-date" onchange="App.load()">
        <div id="history-list" style="margin-top:15px;"></div>
        <button class="btn-danger" style="margin-top:20px; font-size:10px;" onclick="App.resetVault()">ØªØµÙÙŠØ± Ø§Ù„Ø´ÙØª</button>

    </main>

<script>
    const App = {
        db: null, role: '', trips: [], img: '',

        init: function() {
            firebase.initializeApp({ databaseURL: "https://yalla-scooter-pro-default-rtdb.firebaseio.com" });
            this.db = firebase.database();
            this.sync();
            setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('ar-EG'); }, 1000);
        },

        login: function() {
            const pin = document.getElementById('pinCode').value;
            if(pin === "9924") { this.role = 'admin'; document.getElementById('admin-stats').classList.remove('hidden'); }
            else if(pin === "1213") { this.role = 'staff'; }
            else if(pin === "1214") { return this.registerScooter(); }
            else { return alert("Ø§Ù„ÙƒÙˆØ¯ Ø®Ø·Ø£!"); }

            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('header').classList.remove('hidden');
            document.getElementById('main').classList.remove('hidden');
            this.init();
        },

        // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù€ 1214 Ù„ØªØ³Ø¬ÙŠÙ„ Ø³ÙƒÙˆØªØ± Ø¬Ø¯ÙŠØ¯ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ---
        registerScooter: function() {
            Swal.fire({
                title: 'ØªØ³Ø¬ÙŠÙ„ Ø³ÙƒÙˆØªØ± Ø¬Ø¯ÙŠØ¯',
                input: 'text',
                inputPlaceholder: 'Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ±...',
                showCancelButton: true
            }).then(r => {
                if(r.value) {
                    firebase.initializeApp({ databaseURL: "https://yalla-scooter-pro-default-rtdb.firebaseio.com" });
                    firebase.database().ref('scooters_online/' + r.value).set({
                        name: r.value,
                        status: 'Available',
                        lastActive: Date.now()
                    });
                    Swal.fire('ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„', `Ø§Ù„Ø³ÙƒÙˆØªØ± ${r.value} Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù† ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª`, 'success');
                }
            });
        },

        handleImg: function(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { this.img = e.target.result; };
                reader.readAsDataURL(input.files[0]);
            }
        },

        setT: (id) => { const n = new Date(); document.getElementById(id).value = n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0'); },

        saveTrip: async function(isErr) {
            const scoot = document.getElementById('scoot').value;
            const start = document.getElementById('t1').value;
            let end = document.getElementById('t2').value;
            let disc = 0, note = "Ø³Ù„ÙŠÙ… âœ…";

            if(!scoot || !start) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
            if(isErr) {
                const why = prompt("Ø³Ø¨Ø¨ Ø§Ù„Ø¹Ø·Ù„ØŸ"); if(!why) return;
                disc = parseFloat(prompt("Ø®ØµÙ…ØŸ") || 0);
                note = "Ø¹Ø·Ù„: " + why;
                const n = new Date(); end = n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0');
            }
            if(!end) return alert("Ø£Ø¯Ø®Ù„ ÙˆÙ‚Øª Ø§Ù„Ø±Ø¬ÙˆØ¹");

            const t1 = new Date("2026-01-01 " + start), t2 = new Date("2026-01-01 " + end);
            if(t2 < t1) t2.setDate(t2.getDate()+1);
            const mins = Math.max(0, Math.floor((t2-t1)/60000)) || 0;
            const final = Math.max(0, (mins * 2) - disc) || 0;

            const day = new Date().toISOString().split('T')[0];
            await this.db.ref('history/' + day).push({ scoot, mins, final, note, disc, staff: document.getElementById('staff').value, time: Date.now() });
            this.db.ref('vault_total').transaction(v => (v || 0) + final);
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸: " + final + " Ø¬.Ù…");
            location.reload();
        },

        sync: function() {
            const day = new Date().toISOString().split('T')[0];
            document.getElementById('archive-date').value = day;
            this.db.ref('vault_total').on('value', s => document.getElementById('vault').innerText = (s.val()||0).toFixed(2));
            this.load();
        },

        load: function() {
            const d = document.getElementById('archive-date').value;
            this.db.ref('history/' + d).on('value', snap => {
                const list = document.getElementById('history-list'); list.innerHTML = "";
                this.trips = [];
                if(snap.exists()) {
                    Object.values(snap.val()).reverse().forEach(h => {
                        this.trips.push(h);
                        list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #111; font-size:11px;"><b>${h.scoot}</b> | ${h.mins}Ø¯ | ${h.final}Ø¬</div>`;
                    });
                }
                this.filter();
            });
        },

        filter: function() {
            const s = document.getElementById('search').value.trim().toUpperCase();
            let m = 0, c = 0;
            this.trips.forEach(t => { if(t.scoot.toUpperCase().includes(s) && s !== "") { m += t.mins; c += t.final; } });
            document.getElementById('st-mins').innerText = m;
            document.getElementById('st-cash').innerText = c.toFixed(2);
        },

        resetVault: () => { if(confirm("ØªØµÙÙŠØ± Ø§Ù„Ø¯Ø±Ø¬ØŸ")) App.db.ref('vault_total').set(0); }
    };
</script>
</body>
</html>
