<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yalla Scooter Pro | V28</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --neon-blue: #00f2ff; 
            --neon-red: #ff0055; 
            --neon-green: #0aff60;
            --bg-dark: #050505;
            --card-bg: #111;
            --input-bg: #1a1a1a;
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; transition: all 0.3s ease; }
        body { background: var(--bg-dark); color: #fff; padding: 15px; line-height: 1.6; }
        
        /* Utility Classes */
        .hidden { display: none !important; }
        .flex-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

        /* Login Overlay */
        #login-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); 
            z-index: 10000; display: flex; align-items: center; justify-content: center; 
            backdrop-filter: blur(10px);
        }
        .login-box { 
            width: 85%; max-width: 380px; padding: 40px 25px; 
            border: 1px solid var(--neon-blue); border-radius: 30px; 
            text-align: center; background: #000; box-shadow: 0 0 20px rgba(0,242,255,0.2);
        }

        /* Main Container */
        .app-container { max-width: 500px; margin: auto; }
        header { text-align: center; margin-bottom: 25px; }
        h1 { color: var(--neon-blue); font-size: 28px; font-weight: 900; letter-spacing: 1px; }
        
        /* Cards & Sections */
        .section { 
            background: var(--card-bg); padding: 20px; border-radius: 20px; 
            border: 1px solid #222; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        label { display: block; margin-bottom: 8px; font-size: 13px; color: var(--neon-blue); font-weight: 600; }
        
        /* Inputs */
        input { 
            width: 100%; padding: 14px; background: var(--input-bg); border: 1px solid #333; 
            border-radius: 12px; color: #fff; font-size: 16px; margin-bottom: 15px; text-align: center;
        }
        input:focus { border-color: var(--neon-blue); outline: none; box-shadow: 0 0 10px rgba(0,242,255,0.1); }

        /* Buttons */
        button { 
            cursor: pointer; border: none; border-radius: 12px; font-weight: bold; 
            padding: 15px; font-size: 15px; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: var(--neon-blue); color: #000; width: 100%; }
        .btn-primary:active { transform: scale(0.98); }
        .btn-outline-red { background: transparent; border: 1px solid var(--neon-red); color: var(--neon-red); width: 100%; }
        
        .btn-remote { flex: 1; padding: 12px; font-size: 13px; }
        .unlock { background: rgba(10, 255, 96, 0.1); color: var(--neon-green); border: 1px solid var(--neon-green); }
        .lock { background: rgba(255, 0, 85, 0.1); color: var(--neon-red); border: 1px solid var(--neon-red); }

        /* Dashboard Stats */
        .revenue-card { 
            background: linear-gradient(135deg, var(--neon-blue), #00a2ff); 
            color: #000; padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 25px;
        }
        .revenue-card h2 { font-size: 32px; font-weight: 900; }

        /* Data Table */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th { color: #666; padding: 10px; font-weight: 400; border-bottom: 1px solid #222; }
        td { padding: 15px 10px; border-bottom: 1px solid #1a1a1a; text-align: center; }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-left: 5px; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h1 style="margin-bottom: 20px;">Yalla Scooter</h1>
            <input type="password" id="entry-pass" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠ">
            <button class="btn-primary" onclick="App.login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="main-app" class="app-container hidden">
        <header>
            <h1>COMMAND CENTER</h1>
            <div id="clock" style="color: var(--neon-blue); font-weight: bold; opacity: 0.8;"></div>
        </header>

        <div class="section">
            <label>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙƒÙˆØªØ± ÙˆØ§Ù„Ø±Ø­Ù„Ø©</label>
            <input type="text" id="scooter" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ± (Ù…Ø«Ø§Ù„: A10)">
            <input type="text" id="staff" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„">
            
            <div class="flex-grid" style="margin-bottom: 20px;">
                <button class="btn-remote unlock" onclick="App.sendRemote('UNLOCK')">ğŸ”“ ÙØªØ­ Ø§Ù„Ù‚ÙÙ„</button>
                <button class="btn-remote lock" onclick="App.sendRemote('LOCK')">ğŸ”’ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙÙ„</button>
            </div>

            <div class="flex-grid">
                <div>
                    <label>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</label>
                    <input type="time" id="start-t">
                    <button class="btn-primary" style="padding: 5px; font-size: 11px;" onclick="App.setNow('start-t')">Ø§Ù„Ø¢Ù†</button>
                </div>
                <div>
                    <label>ÙˆÙ‚Øª Ø§Ù„Ø¹ÙˆØ¯Ø©</label>
                    <input type="time" id="end-t">
                    <button class="btn-primary" style="padding: 5px; font-size: 11px;" onclick="App.setNow('end-t')">Ø§Ù„Ø¢Ù†</button>
                </div>
            </div>
        </div>

        <button class="btn-primary" style="margin-bottom: 10px;" onclick="App.save(false)">âœ… Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø­Ù„Ø©</button>
        <button class="btn-outline-red" onclick="App.save(true)">ğŸš¨ ØªØ³Ø¬ÙŠÙ„ Ø¹Ø·Ù„ ÙÙ†ÙŠ / Ø®ØµÙ…</button>

        <div class="revenue-card">
            <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¯Ø®Ù„ Ø§Ù„ÙŠÙˆÙ…</small>
            <h2 id="shift-total">0.00</h2>
            <small>Ø¬Ù†ÙŠØ© Ù…ØµØ±ÙŠ</small>
        </div>

        <div class="section">
            <label>Ø³Ø¬Ù„ Ø§Ù„Ø±Ø­Ù„Ø§Øª</label>
            <input type="date" id="history-date" onchange="App.load()">
            <div class="table-container">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø³ÙƒÙˆØªØ±</th>
                            <th>Ø§Ù„Ù…Ø¯Ø©</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

<script>
    // Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCJOSLUFRAZV4YWYFDB9VLvju",
        authDomain: "yala-scooter.firebaseapp.com",
        databaseURL: "https://yalla-scooter-default-rtdb.firebaseio.com",
        projectId: "yala-scooter",
        storageBucket: "yala-scooter.firebasestorage.app",
        messagingSenderId: "1014076976512",
        appId: "1:1014076976512:web:c053191787884674720970"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const App = {
        login: function() {
            const pass = document.getElementById('entry-pass').value;
            if(pass === "9924") {
                localStorage.setItem('yalla_session', btoa('authorized'));
                this.showApp();
            } else {
                alert("ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­");
            }
        },

        showApp: function() {
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            this.init();
        },

        init: function() {
            document.getElementById('history-date').value = new Date().toISOString().split('T')[0];
            this.load();
            setInterval(() => { 
                const now = new Date();
                document.getElementById('clock').innerText = now.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            }, 1000);
        },

        sendRemote: function(cmd) {
            const scoot = document.getElementById('scooter').value;
            if(!scoot) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ± Ø£ÙˆÙ„Ø§Ù‹");
            
            const confirmMsg = cmd === 'UNLOCK' ? "ØªØ£ÙƒÙŠØ¯ ÙØªØ­ Ø§Ù„Ø³ÙƒÙˆØªØ±ØŸ" : "ØªØ£ÙƒÙŠØ¯ Ù‚ÙÙ„ Ø§Ù„Ø³ÙƒÙˆØªØ±ØŸ";
            if(confirm(confirmMsg)) {
                db.ref('commands/' + scoot).set({
                    action: cmd,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                }).then(() => {
                    alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
                });
            }
        },

        setNow: function(id) {
            const n = new Date();
            document.getElementById(id).value = n.getHours().toString().padStart(2,'0') + ":" + n.getMinutes().toString().padStart(2,'0');
        },

        save: async function(isErr) {
            const scoot = document.getElementById('scooter').value;
            const staff = document.getElementById('staff').value;
            const start = document.getElementById('start-t').value;
            let end = document.getElementById('end-t').value;
            let disc = 0;

            if(!scoot || !start || !staff) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ (Ø§Ù„Ø³ÙƒÙˆØªØ±ØŒ Ø§Ù„Ù…ÙˆØ¸ÙØŒ ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬)");

            if(isErr) {
                disc = parseFloat(prompt("Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ… Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø¹Ø·Ù„:") || 0);
                this.setNow('end-t');
                end = document.getElementById('end-t').value;
            }

            if(!end) return alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø¹ÙˆØ¯Ø©");

            // Calculation Logic
            const t1 = new Date("2026-01-01 " + start);
            let t2 = new Date("2026-01-01 " + end);
            if(t2 < t1) t2.setDate(t2.getDate() + 1);
            
            const mins = Math.max(0, Math.floor((t2 - t1) / 60000));
            const final = Math.max(0, (mins * 2) - disc);

            const data = {
                staff, scoot, start, end, mins, final,
                isError: isErr,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            try {
                const dateKey = new Date().toISOString().split('T')[0];
                await db.ref('history/' + dateKey).push(data);
                alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­");
                this.resetForm();
            } catch (e) {
                alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
            }
        },

        resetForm: function() {
            document.getElementById('scooter').value = "";
            document.getElementById('start-t').value = "";
            document.getElementById('end-t').value = "";
            this.load();
        },

        load: function() {
            const date = document.getElementById('history-date').value;
            db.ref('history/' + date).on('value', snap => {
                const body = document.querySelector("#data-table tbody");
                body.innerHTML = ""; 
                let total = 0;
                
                if(snap.exists()) {
                    const logs = [];
                    snap.forEach(child => { logs.push(child.val()); });
                    logs.reverse().forEach(t => {
                        const statusColor = t.isError ? 'var(--neon-red)' : 'var(--neon-green)';
                        body.innerHTML += `
                            <tr>
                                <td><span class="status-dot" style="background:${statusColor}"></span><b>${t.scoot}</b></td>
                                <td>${t.mins} Ø¯Ù‚ÙŠÙ‚Ø©</td>
                                <td style="color:var(--neon-blue)">${parseFloat(t.final).toFixed(2)}</td>
                                <td style="font-size:10px">${t.isError ? 'ğŸ›‘ Ø¹Ø·Ù„' : 'âœ… Ø±Ø­Ù„Ø©'}</td>
                            </tr>`;
                        total += parseFloat(t.final);
                    });
                }
                document.getElementById('shift-total').innerText = total.toFixed(2);
            });
        }
    };

    // Session Check
    if(localStorage.getItem('yalla_session') === btoa('authorized')) {
        App.showApp();
    }
</script>
</body>
</html>
