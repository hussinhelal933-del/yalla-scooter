<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yalla App V58 | Titan Master Control</title>
    
    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Ø§Ù„Ø®Ø±Ø§Ø¦Ø· -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #000; --card: #0a0a0a; --glass: rgba(15, 20, 35, 0.98);
            --primary: #00d2ff; --accent: #0072ff; --danger: #ff0055;
            --success: #00ff9d; --warn: #ffcc00; --border: rgba(0, 210, 255, 0.15);
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* App Header */
        .app-header { 
            height: 70px; background: #050505; border-bottom: 1px solid #111; 
            display: flex; justify-content: space-between; align-items: center; padding: 0 20px;
            position: sticky; top: 0; z-index: 2000;
        }
        .app-header .logo { font-family: 'Rajdhani'; font-weight: 900; color: var(--primary); font-size: 22px; }
        .menu-btn { font-size: 24px; color: var(--primary); cursor: pointer; }

        /* Sidebar */
        .sidebar { 
            position: fixed; top: 0; right: -100%; width: 85%; height: 100%; 
            background: #050505; z-index: 3000; transition: 0.4s cubic-bezier(0.8, 0, 0.2, 1);
            display: flex; flex-direction: column; border-left: 1px solid #222;
        }
        .sidebar.active { right: 0; box-shadow: -20px 0 50px #000; }
        .nav-item { padding: 18px 25px; margin: 8px 15px; border-radius: 15px; display: flex; align-items: center; gap: 15px; font-weight: bold; color: #777; }
        .nav-item.active { background: rgba(0,210,255,0.1); color: var(--primary); }

        /* Content */
        .app-content { flex: 1; overflow-y: auto; padding: 15px; background: radial-gradient(circle at top right, #0a1225, #000); }

        .kpi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .kpi-card { background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 20px; text-align: center; }
        .kpi-val { font-family: 'Rajdhani'; font-size: 22px; font-weight: 900; color: #fff; display: block; }

        .unit-card { background: var(--card); border: 1px solid var(--border); border-radius: 25px; padding: 15px; margin-bottom: 15px; position: relative; }
        .unit-timer { font-family: 'Rajdhani'; font-size: 40px; text-align: center; color: var(--primary); font-weight: 900; margin: 10px 0; }
        .id-img { width: 100%; height: 120px; object-fit: cover; border-radius: 15px; border: 1px solid #222; margin: 10px 0; background: #000; }

        .btn { padding: 14px; border: none; border-radius: 12px; font-weight: 900; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; margin-bottom: 8px; width: 100%; transition: 0.2s; }
        .btn-primary { background: linear-gradient(135deg, var(--accent), var(--primary)); color: #fff; }
        .btn-danger { background: rgba(255,0,85,0.1); color: var(--danger); border: 1px solid var(--danger); }
        .btn-success { background: rgba(0, 255, 157, 0.1); color: var(--success); border: 1px solid var(--success); }

        input { background: #0c0c0c !important; border: 1px solid #222 !important; color: #fff !important; border-radius: 12px !important; padding: 15px !important; margin-bottom: 10px; width: 100%; font-size: 16px; }

        .section { display: none; }
        .section.active { display: block; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        #login-overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 25px; }
        .sos-btn { background: var(--danger); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: fixed; bottom: 20px; left: 20px; z-index: 1000; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± */
        .speed-circle { width: 180px; height: 180px; border: 5px solid var(--primary); border-radius: 50%; margin: 20px auto; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 0 30px var(--primary); }
        .speed-num { font-family: 'Rajdhani'; font-size: 65px; font-weight: 900; color: #fff; }
        #admin-map { width: 100%; height: 350px; border-radius: 20px; border: 1px solid var(--primary); margin-top: 10px; }
    </style>
</head>
<body>

    <!-- 1. Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-overlay">
        <div style="text-align:center; width:100%; max-width:320px;">
            <h1 style="font-family:'Rajdhani'; color:var(--primary); font-size: 38px; margin-bottom: 10px;">YALLA TITAN</h1>
            <input type="password" id="passInput" style="text-align:center; font-size:28px;" placeholder="****">
            <button onclick="login()" class="btn btn-primary" style="margin-top:20px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</button>
        </div>
    </div>

    <!-- 2. Ø§Ù„Ø±Ø£Ø³ -->
    <header class="app-header">
        <div class="logo">TITAN V58</div>
        <div id="clock" style="font-family:'Rajdhani'; color:var(--primary); font-size:14px; font-weight:bold;">00:00:00</div>
        <div class="menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars-staggered"></i></div>
    </header>

    <!-- 3. Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
    <nav id="sidebar" class="sidebar">
        <div style="padding:40px 20px; text-align:center; border-bottom:1px solid #111;">
            <div id="shift-user-display" style="font-size:14px; color:var(--success); font-weight:bold;">Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ù…ØºÙ„Ù‚Ø©</div>
        </div>
        <div style="flex:1; padding-top:10px; overflow-y:auto;">
            <div class="nav-item active" onclick="nav('ops')"><i class="fas fa-rocket"></i> Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
            <div class="nav-item" onclick="nav('tasks')"><i class="fas fa-clipboard-check"></i> Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</div>
            <div id="adm-nav" class="nav-item" style="display:none" onclick="nav('admin')"><i class="fas fa-chart-line"></i> Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div>
            <div id="track-nav" class="nav-item" style="display:none" onclick="nav('track')"><i class="fas fa-location-dot"></i> ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„</div>
            <div class="nav-item" onclick="nav('maint')"><i class="fas fa-tools"></i> Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
        </div>
        <div style="padding:20px;">
            <button id="shift-btn" onclick="toggleShift()" class="btn btn-primary">ÙØªØ­ ÙˆØ±Ø¯ÙŠØ©</button>
        </div>
    </nav>

    <!-- 4. Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <main class="app-content">
        <div class="kpi-grid">
            <div class="kpi-card"><span class="kpi-val" id="k-active">0</span><small>Ù†Ø´Ø·</small></div>
            <div class="kpi-card"><span class="kpi-val" id="k-cash" style="color:var(--success)">0</span><small>Ø§Ù„ØµØ§ÙÙŠ</small></div>
        </div>

        <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
        <div id="sec-ops" class="section active">
            <button class="btn btn-primary" onclick="startTripPopup()" style="height:60px; font-size:16px;">+ Ø¨Ø¯Ø¡ Ø±Ø­Ù„Ø©</button>
            <div id="fleet-grid"></div>
        </div>

        <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± (Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø±Ø¹Ø©) -->
        <div id="sec-renter" class="section">
            <div style="text-align:center">
                <h2 id="renter-scooter-name" style="color:var(--primary)">S1</h2>
                <div class="speed-circle">
                    <span class="speed-num" id="live-speed">0</span>
                    <small>KM/H</small>
                </div>
                <div id="live-battery" style="color:var(--success); font-weight:bold; font-size:20px;">--%</div>
                <button class="btn btn-danger" style="margin-top:30px;" onclick="nav('ops')">Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</button>
            </div>
        </div>

        <!-- ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± (Ø§Ù„Ø®Ø±ÙŠØ·Ø©) -->
        <div id="sec-track" class="section">
            <h3 style="color:var(--primary)">ğŸ›°ï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø·ÙˆÙ„ Ø§Ù„Ø­ÙŠØ©</h3>
            <div id="admin-map"></div>
            <div id="admin-scooter-details" style="margin-top:10px;"></div>
        </div>

        <div id="sec-admin" class="section">
            <h3 id="fin-rev">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h3>
            <div id="action-logs" style="background:#050505; border-radius:15px; padding:10px; height:200px; overflow-y:auto; font-size:11px; color:#666;"></div>
        </div>
    </main>

    <div class="sos-btn" onclick="triggerSOS()"><i class="fas fa-biohazard"></i></div>

<script>
    // --- 1. Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ÙˆØ§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ ---
    const TELEGRAM = { token: "8596127440:AAGNZDaao8fqddjMfEu38ZHrCTyOs9hrchs", chat: "5684905593" };
    firebase.initializeApp({ databaseURL: "https://yalla-scooter-pro-default-rtdb.firebaseio.com" });
    const db = firebase.database();

    let scooterChar = null, gpsWatcher = null, map = null, markers = {};
    let activeTrips = {}, config = { baseCost: 40, pricePerMin: 2.66 }, currentShiftId = null, isAdmin = false;

    // --- 2. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ (Fixed) ---
    function login() {
        const p = document.getElementById('passInput').value;
        if(p === "1213") { 
            isAdmin = false; 
            document.getElementById('login-overlay').style.display='none'; 
            init(); 
        } else if(p === "9924") { 
            isAdmin = true; 
            document.getElementById('adm-nav').style.display='flex'; 
            document.getElementById('track-nav').style.display='flex';
            document.getElementById('login-overlay').style.display='none'; 
            init(); 
        } else {
            alert("Ø§Ù„Ø±Ù…Ø² Ø®Ø·Ø£");
        }
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
    
    function nav(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('sec-'+id).classList.add('active');
        const navItem = document.querySelector(`[onclick="nav('${id}')"]`);
        if(navItem) navItem.classList.add('active');
        toggleSidebar();
        if(id === 'track') initAdminMap();
    }

    // --- 3. Ø¨Ù„ÙˆØªÙˆØ« ÙˆØªØ­ÙƒÙ… Ø¹Ù† Ø¨Ø¹Ø¯ ---
    async function startTripPopup() {
        if(!currentShiftId) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡','Ø§ÙØªØ­ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹','warning');
        
        try {
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ namePrefix: 'MIScooter' }, { namePrefix: 'Mi' }],
                optionalServices: ["00001a00-0000-1000-8000-00805f9b34fb"]
            });
            const server = await device.gatt.connect();
            const service = await server.getPrimaryService("00001a00-0000-1000-8000-00805f9b34fb");
            scooterChar = await service.getCharacteristic("00001a01-0000-1000-8000-00805f9b34fb");
            
            await scooterChar.startNotifications();
            scooterChar.addEventListener('characteristicvaluechanged', (e) => {
                let v = e.target.value;
                let speed = (v.getUint16(10, true) / 1000).toFixed(0);
                let batt = v.getUint8(15);
                document.getElementById('live-speed').innerText = speed;
                document.getElementById('live-battery').innerText = batt + "%";
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø¯ÙŠØ± Ù„Ø§ÙŠÙ
                if(window.currentScooter) {
                    db.ref('telemetry/'+window.currentScooter).update({ speed, batt });
                }
            });

            const { value: res } = await Swal.fire({
                title: 'Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©',
                html: '<input id="sw-ph" class="swal2-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"><input id="sw-sc" class="swal2-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ±">',
                preConfirm: () => [document.getElementById('sw-ph').value, document.getElementById('sw-sc').value]
            });

            if(res && res[0]) {
                const [ph, sc] = res;
                window.currentScooter = sc;
                // ÙØªØ­ Ø§Ù„Ø³ÙƒÙˆØªØ±
                await scooterChar.writeValue(new Uint8Array([0x55, 0xAA, 0x03, 0x20, 0x03, 0x70, 0x01, 0x69, 0xFF]));
                
                const tripRef = db.ref('active_trips').push();
                const key = tripRef.key;
                tripRef.set({ phone: ph, scooter: sc, startTime: Date.now(), status: 'active', lat:0, lon:0 });
                
                nav('renter');
                document.getElementById('renter-scooter-name').innerText = sc;
                
                // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¯ÙŠØ±
                startTracking(key);
                listenToRemoteCommands(sc);
                
                sendTG(`ğŸš€ Ø±Ø­Ù„Ø© Ø¨Ø¯Ø£Øª: ${sc} Ù„Ù€ ${ph}`);
            }
        } catch(e) { Swal.fire('Ø®Ø·Ø£ Ø¨Ù„ÙˆØªÙˆØ«', 'ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ« ÙˆØ§Ù„Ù€ GPS', 'error'); }
    }

    // Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù‚ÙÙ„ Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ± Ø¹Ù† Ø¨Ø¹Ø¯
    function listenToRemoteCommands(scId) {
        db.ref('commands/'+scId).on('value', async snap => {
            const cmd = snap.val();
            if(cmd && cmd.action === 'lock' && scooterChar) {
                await scooterChar.writeValue(new Uint8Array([0x55, 0xAA, 0x03, 0x20, 0x03, 0x70, 0x00, 0x6A, 0xFF]));
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ø³ÙƒÙˆØªØ± Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„', 'warning');
                db.ref('commands/'+scId).remove();
            }
        });
    }

    // --- 4. Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ø®Ø±Ø§Ø¦Ø· ---
    function startTracking(key) {
        if (navigator.geolocation) {
            gpsWatcher = navigator.geolocation.watchPosition(pos => {
                db.ref('active_trips/'+key).update({ lat: pos.coords.latitude, lon: pos.coords.longitude });
            }, null, { enableHighAccuracy: true });
        }
        // Ù…Ù†Ø¹ Ù†ÙˆÙ… Ø§Ù„Ø´Ø§Ø´Ø©
        if(navigator.wakeLock) navigator.wakeLock.request('screen');
    }

    function initAdminMap() {
        if(map) return;
        map = L.map('admin-map').setView([30.0444, 31.2357], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        db.ref('active_trips').on('value', snap => {
            snap.forEach(t => {
                const d = t.val();
                if(d.lat) {
                    db.ref('telemetry/'+d.scooter).once('value', telSnap => {
                        const tel = telSnap.val() || { speed: 0, batt: '--' };
                        const popupContent = `
                            <b>Ø³ÙƒÙˆØªØ±: ${d.scooter}</b><br>
                            Ø§Ù„Ø³Ø±Ø¹Ø©: ${tel.speed} ÙƒÙ…/Ø³<br>
                            Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©: ${tel.batt}%<br>
                            <button onclick="remoteEmergencyLock('${d.scooter}')" style="background:red; color:white; border:none; padding:5px; border-radius:5px; cursor:pointer;">Ù‚ÙÙ„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ğŸ”’</button>
                        `;
                        if(markers[t.key]) {
                            markers[t.key].setLatLng([d.lat, d.lon]).getPopup().setContent(popupContent);
                        } else {
                            markers[t.key] = L.marker([d.lat, d.lon]).addTo(map).bindPopup(popupContent);
                        }
                    });
                }
            });
        });
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ù‚ÙÙ„ Ø¹Ù† Ø¨Ø¹Ø¯
    window.remoteEmergencyLock = function(scId) {
        Swal.fire({
            title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
            text: "Ø³ÙŠØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø³ÙƒÙˆØªØ± ÙÙˆØ±Ø§Ù‹!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ù‚ÙÙ„ Ø§Ù„Ø¢Ù†'
        }).then((result) => {
            if (result.isConfirmed) {
                db.ref('commands/'+scId).set({ action: 'lock', time: Date.now() });
                sendTG(`âš ï¸ <b>ØªØ­Ø°ÙŠØ±:</b> Ø§Ù„Ù…Ø¯ÙŠØ± Ù‚Ø§Ù… Ø¨Ù‚ÙÙ„ Ø§Ù„Ø³ÙƒÙˆØªØ± ${scId} Ø¹Ù† Ø¨ÙØ¹Ø¯!`);
            }
        });
    };

    // --- 5. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© ---
    function init() {
        db.ref('shifts/current').on('value', s => {
            currentShiftId = s.exists() ? s.key : null;
            document.getElementById('shift-user-display').innerText = s.exists() ? "Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: " + s.val().user : "Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ù…ØºÙ„Ù‚Ø©";
            document.getElementById('shift-btn').innerText = s.exists() ? "ØªØµÙÙŠØ© Ø§Ù„ÙˆØ±Ø¯ÙŠØ©" : "ÙØªØ­ ÙˆØ±Ø¯ÙŠØ©";
        });
        db.ref('active_trips').on('value', snap => {
            activeTrips = snap.val() || {};
            const grid = document.getElementById('fleet-grid'); grid.innerHTML = "";
            for(let k in activeTrips) {
                grid.innerHTML += `
                    <div class="unit-card">
                        <div style="display:flex; justify-content:space-between"><b>${activeTrips[k].scooter}</b> <small>${activeTrips[k].phone}</small></div>
                        <button class="btn btn-danger" onclick="terminateTrip('${k}')">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</button>
                    </div>`;
            }
            document.getElementById('k-active').innerText = Object.keys(activeTrips).length;
        });
        db.ref('logs/actions').limitToLast(20).on('value', snap => {
            const box = document.getElementById('action-logs'); box.innerHTML = "";
            snap.forEach(l => { box.innerHTML = `<div>[${new Date(l.val().time).toLocaleTimeString()}] ${l.val().msg}</div>` + box.innerHTML; });
        });
    }

    async function terminateTrip(key) {
        const t = activeTrips[key];
        if(scooterChar) {
            await scooterChar.writeValue(new Uint8Array([0x55, 0xAA, 0x03, 0x20, 0x03, 0x70, 0x00, 0x6A, 0xFF]));
        }
        if(gpsWatcher) navigator.geolocation.clearWatch(gpsWatcher);
        db.ref('active_trips/'+key).remove();
        db.ref('telemetry/'+t.scooter).remove();
        sendTG(`ğŸ Ø¥Ù†Ù‡Ø§Ø¡ Ø±Ø­Ù„Ø©: ${t.scooter}`);
        nav('ops');
        Swal.fire('ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
    }

    function toggleShift() {
        if(!currentShiftId) {
            db.ref('shifts/current').set({ user: "Ù…ÙˆØ¸Ù ØªÙŠØªØ§Ù†", start: Date.now() });
            sendTG("ğŸŸ¢ ØªÙ… ÙØªØ­ ÙˆØ±Ø¯ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©");
        } else {
            db.ref('shifts/current').remove();
            sendTG("ğŸ ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©");
        }
    }

    function triggerSOS() { 
        sendTG(`ğŸš¨ <b>Ø§Ø³ØªØºØ§Ø«Ø©!</b> Ø§Ù„Ù…ÙˆØ¸Ù ÙŠØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙˆØ±ÙŠØ©!`); 
        Swal.fire('ØªÙ… Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'); 
    }

    function logAction(m) { db.ref('logs/actions').push({ msg: m, time: Date.now() }); }

    setInterval(() => { 
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('ar-EG'); 
    }, 1000);
</script>
</body>
</html>
