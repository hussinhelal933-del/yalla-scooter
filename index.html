<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://hussinhelal933-del.vercel.app/logo.png">

    <title>Yalla Scooter V67 | The Absolute Empire</title>
    
    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-deep: #051937; --primary: #00d2ff; --danger: #ff0055; 
            --success: #00ff9d; --warn: #ffcc00; --glass: rgba(10, 25, 45, 0.98);
            --border: rgba(0, 210, 255, 0.2);
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg-deep); color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; overscroll-behavior: none; }

        /* App Header */
        .app-header { 
            height: 95px; background: rgba(5, 25, 55, 0.95); border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: flex-end; padding: 0 20px 15px;
            position: sticky; top: 0; z-index: 2000; backdrop-filter: blur(15px);
        }
        .logo-text { font-family: 'Rajdhani'; font-weight: 900; color: var(--primary); font-size: 26px; letter-spacing: 1px; }

        /* Main Content Area */
        .app-content { flex: 1; overflow-y: auto; padding: 15px; background: radial-gradient(circle at top right, #102a4d, #051937); padding-bottom: 100px; }

        /* KPI Grid */
        .kpi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .kpi-card { background: var(--glass); border: 1px solid var(--border); padding: 15px; border-radius: 20px; text-align: center; }
        .kpi-val { font-family: 'Rajdhani'; font-size: 22px; font-weight: 900; color: #fff; }

        /* Unit Cards */
        .unit-card { background: var(--glass); border: 1px solid var(--border); border-radius: 30px; padding: 18px; margin-bottom: 15px; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .unit-timer { font-family: 'Rajdhani'; font-size: 45px; text-align: center; color: var(--primary); font-weight: 900; margin: 10px 0; }
        .id-img { width: 100%; height: 140px; object-fit: cover; border-radius: 18px; border: 1px solid #222; margin: 10px 0; }

        /* Bottom Tab Bar */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 75px; 
            background: rgba(5, 15, 35, 0.98); backdrop-filter: blur(20px);
            border-top: 1px solid var(--border); display: flex; justify-content: space-around;
            align-items: center; z-index: 2500; padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-link { display: flex; flex-direction: column; align-items: center; color: #445b7a; font-size: 9px; font-weight: bold; transition: 0.3s; text-decoration: none; }
        .nav-link i { font-size: 20px; margin-bottom: 4px; }
        .nav-link.active { color: var(--primary); transform: translateY(-3px); }

        /* Buttons */
        .btn { padding: 15px; border: none; border-radius: 15px; font-weight: 900; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; margin-bottom: 8px; font-size: 14px; }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background: linear-gradient(135deg, var(--accent), var(--primary)); color: #fff; }
        .btn-danger { background: rgba(255,0,85,0.1); color: var(--danger); border: 1px solid var(--danger); }
        .btn-success { background: rgba(0, 255, 157, 0.1); color: var(--success); border: 1px solid var(--success); }
        .btn-warn { background: rgba(255, 204, 0, 0.1); color: var(--warn); border: 1px solid var(--warn); }

        input, select, textarea { background: #081120 !important; border: 1px solid #1a3250 !important; color: #fff !important; border-radius: 12px !important; padding: 16px !important; margin-bottom: 12px; width: 100%; font-size: 16px; }

        .section { display: none; }
        .section.active { display: block; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Alerts & Icons */
        .sos-btn { background: var(--danger); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: fixed; bottom: 90px; left: 20px; z-index: 1000; box-shadow: 0 0 25px var(--danger); animation: pulse 1.2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .fab { background: var(--primary); color: #000; width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: fixed; bottom: 90px; right: 20px; z-index: 1000; font-size: 26px; box-shadow: 0 10px 30px rgba(0,210,255,0.4); }
        .debt-alert { background: var(--danger); color: #fff; padding: 5px; border-radius: 8px; font-size: 11px; font-weight: 900; margin-top: 5px; text-align: center; }

        .glass-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        .glass-table td { background: rgba(255,255,255,0.02); padding: 12px; border-top: 1px solid #111; font-size: 12px; color: #ccc; }
        
        #login-overlay { position: fixed; inset: 0; background: var(--bg-deep); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 30px; }
    </style>
</head>
<body>

    <!-- 1. Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-overlay">
        <div style="text-align:center; width:100%; max-width:350px;">
            <img src="https://hussinhelal933-del.vercel.app/logo.png" style="width:120px; margin-bottom:20px; filter: drop-shadow(0 0 15px var(--primary));">
            <h1 style="font-family:'Rajdhani'; color:#fff; font-size: 38px; margin:0;">YALLA COMMAND</h1>
            <p style="color:var(--primary); font-size: 11px; margin-bottom: 35px; font-weight: bold;">PREMIUM SYSTEM V67</p>
            <input type="password" id="passInput" style="text-align:center; font-size:35px; letter-spacing:12px;" placeholder="****">
            <button onclick="login()" class="btn btn-primary" style="margin-top:20px; height:70px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©</button>
        </div>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="logo-text">YALLA COMMAND</div>
        <div id="clock" style="font-family:'Rajdhani'; color:var(--primary); font-size:14px; font-weight:bold;">00:00:00</div>
    </header>

    <!-- Main Content Tabs -->
    <main class="app-content">
        <!-- Live Counters -->
        <div class="kpi-grid">
            <div class="kpi-card"><span class="kpi-val" id="k-active">0</span><small style="color:var(--primary)">Ù†Ø´Ø·</small></div>
            <div class="kpi-card"><span class="kpi-val" id="k-cash" style="color:var(--success)">0</span><small style="color:var(--primary)">Ø§Ù„Ø¯Ø±Ø¬</small></div>
            <div class="kpi-card"><span class="kpi-val" id="k-maint" style="color:var(--danger)">0</span><small style="color:var(--primary)">ØµÙŠØ§Ù†Ø©</small></div>
            <div class="kpi-card"><span class="kpi-val" id="k-wait" style="color:var(--warn)">0</span><small style="color:var(--primary)">Ø±Ø§Ø¯Ø§Ø±</small></div>
        </div>

        <!-- 1. Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ø±Ø­Ù„Ø§Øª) -->
        <div id="sec-ops" class="section active"><div id="fleet-grid"></div></div>

        <!-- 2. Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± -->
        <div id="sec-wait" class="section">
            <h3 style="color:var(--primary)">â³ Ø±Ø§Ø¯Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>
            <div id="waitlist-container"></div>
            <button class="btn btn-primary" onclick="addToWaitlistPopup()">+ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø±Ø§Ø¯Ø§Ø±</button>
        </div>

        <!-- 3. Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ø¯ÙŠÙˆÙ† ÙˆØ­Ø¸Ø±) -->
        <div id="sec-clients" class="section">
            <input type="tel" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù…..." oninput="loadClients(this.value)">
            <div id="clients-list"></div>
        </div>

        <!-- 4. Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
        <div id="sec-tasks" class="section">
            <h3 style="color:var(--primary)">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
            <div id="tasks-list"></div>
            <button id="adm-task-btn" class="btn btn-success" style="display:none" onclick="addTaskPopup()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
        </div>

        <!-- 5. Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„Ù…Ø®Ø²Ù† -->
        <div id="sec-maint" class="section">
            <h3 style="color:var(--warn)">âš ï¸ ØºÙŠØ§Ø± Ø²ÙŠØª (Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ)</h3>
            <div id="preventive-list"></div>
            <h3 style="color:var(--danger); margin-top:20px;">ğŸ”´ Ø£Ø¹Ø·Ø§Ù„ Ù…Ø³Ø¬Ù„Ø©</h3>
            <div id="active-maint-list"></div>
            <button class="btn btn-danger" onclick="reportIssuePopup()">+ Ø¨Ù„Ø§Øº Ø¹Ø·Ù„ ÙÙ†ÙŠ</button>
            <hr style="border:0; border-top:1px solid #111; margin:20px 0;">
            <h3>ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù†</h3>
            <div id="store-list"></div>
            <button class="btn btn-success" onclick="addStockPopup()">+ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
        </div>

        <!-- 6. Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ (Ø§Ù„Ù…Ø¯ÙŠØ±) -->
        <div id="sec-admin" class="section">
            <input type="date" id="admin-date-picker" onchange="loadFinanceReport(this.value)">
            <div class="kpi-grid" style="margin-top:15px;">
                <div class="kpi-card"><h3>Ø¥ÙŠØ±Ø§Ø¯</h3><span id="fin-rev" class="kpi-val" style="color:var(--success)">0</span></div>
                <div class="kpi-card"><h3>ØµØ§ÙÙŠ</h3><span id="fin-net" class="kpi-val" style="color:var(--primary)">0</span></div>
            </div>
            <h3>ğŸ“ˆ Ø±Ø¨Ø­ÙŠØ© Ø§Ù„Ø£Ø³Ø·ÙˆÙ„</h3>
            <div style="overflow-x:auto;"><table class="glass-table"><thead><tr style="color:var(--primary)"><th>Ø§Ù„Ø³ÙƒÙˆØªØ±</th><th>Ø¥ÙŠØ±Ø§Ø¯</th><th>ØµÙŠØ§Ù†Ø©</th></tr></thead><tbody id="scooter-roi-list"></tbody></table></div>
            <button class="btn btn-primary" onclick="toggleShift()" id="shift-btn">ØªØµÙÙŠØ© Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</button>
            <h3 id="shift-user-display" style="color:var(--success); text-align:center;">-</h3>
            <h3>ğŸ”’ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
            <div id="action-logs" style="background:rgba(0,0,0,0.3); border-radius:15px; padding:10px; height:200px; overflow-y:auto; font-size:11px; color:#777;"></div>
        </div>

        <!-- 7. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div id="sec-settings" class="section">
            <div class="kpi-card"><h3>ğŸ’° Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø±Ø­Ù„Ø©</h3> ÙØªØ­ Ø§Ù„Ø¹Ø¯Ø§Ø¯: <input type="number" id="conf-baseCost" onchange="saveConfig()"> Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©: <input type="number" id="conf-pricePerMin" onchange="saveConfig()"></div>
            <div class="kpi-card" style="margin-top:15px;">
                <h3>ğŸ›µ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„</h3>
                <div style="display:flex; gap:10px;"><input type="text" id="new-scooter-name" placeholder="S1"><button class="btn btn-primary" onclick="addNewScooter()">+</button></div>
                <div id="fleet-mngt-list" style="display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;"></div>
            </div>
            <button class="btn btn-success" style="margin-top:20px;" onclick="exportDataBackup()"><i class="fas fa-file-export"></i> Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
        </div>
    </main>

    <!-- Bottom Nav Bar -->
    <nav class="bottom-nav">
        <a href="#" class="nav-link active" onclick="nav('ops', this)"><i class="fas fa-rocket"></i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
        <a href="#" class="nav-link" onclick="nav('wait', this)"><i class="fas fa-hourglass-half"></i><span>Ø±Ø§Ø¯Ø§Ø±</span></a>
        <a href="#" class="nav-link" onclick="nav('clients', this)"><i class="fas fa-users"></i><span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span></a>
        <a href="#" class="nav-link" onclick="nav('admin', this)"><i class="fas fa-chart-pie"></i><span>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></a>
        <a href="#" class="nav-link" onclick="nav('settings', this)"><i class="fas fa-cog"></i><span>Ø§Ù„Ù†Ø¸Ø§Ù…</span></a>
    </nav>

    <!-- Floating UI -->
    <div class="sos-btn" onclick="triggerSOS()"><i class="fas fa-biohazard"></i></div>
    <div class="fab" onclick="startTripPopup()"><i class="fas fa-plus"></i></div>

<script>
    // --- 1. CONFIG & FIREBASE ---
    const TELEGRAM = { token: "8596127440:AAGNZDaao8fqddjMfEu38ZHrCTyOs9hrchs", chat: "5684905593" };
    firebase.initializeApp({ databaseURL: "https://yalla-scooter-pro-default-rtdb.firebaseio.com" });
    const db = firebase.database();
    const storage = firebase.storage();

    let activeTrips = {}, config = { baseCost: 40, baseMins: 15, pricePerMin: 2.66 }, currentShiftId = null, currentUser = "Ø§Ù„Ù…ÙˆØ¸Ù", isAdmin = false;

    // --- 2. VOICE & LOGIN ---
    function speak(text) { const m = new SpeechSynthesisUtterance(); m.text = text; m.lang = 'ar-SA'; window.speechSynthesis.speak(m); }
    function login() {
        const p = document.getElementById('passInput').value;
        if(p === "1213") { isAdmin = false; document.getElementById('login-overlay').style.display='none'; init(); speak("ØªÙ… Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸Ù"); }
        else if(p === "9924") { isAdmin = true; document.getElementById('adm-nav').style.display='flex'; document.getElementById('set-nav').style.display='flex'; document.getElementById('adm-task-btn').style.display='block'; document.getElementById('login-overlay').style.display='none'; init(); speak("ØªÙ… Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±"); }
        else Swal.fire('Ø®Ø·Ø£','','error');
    }

    function nav(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySe
