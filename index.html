<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yalla Scooter | V43 ERP</title>
    
    <!-- Firebase & Libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --danger: #ef4444; --success: #10b981; --warning: #f59e0b; --text: #f8fafc; }
        body { background: var(--bg); color: var(--text); margin: 0; font-family: 'Cairo', sans-serif; padding-bottom: 80px; }

        /* Login */
        #start-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-box { background: var(--card); padding: 30px; border-radius: 20px; text-align: center; width: 90%; max-width: 350px; border: 1px solid #334155; }
        .inp-code { width: 100%; padding: 15px; background: #0f172a; border: 1px solid #334155; color: white; text-align: center; font-size: 24px; border-radius: 10px; margin: 15px 0; }

        /* Layout */
        .header { background: var(--card); padding: 15px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; }
        .container { padding: 15px; max-width: 800px; margin: 0 auto; }
        
        /* Buttons Grid */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-action { padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; color: white; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        
        /* Cards */
        .trip-card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 10px; border-right: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        
        /* Admin Dashboard */
        #admin-overlay { position: fixed; inset: 0; background: #0b1120; z-index: 5000; overflow-y: auto; display: none; padding: 20px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-box { background: var(--card); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #334155; }
        .stat-val { font-size: 18px; font-weight: bold; }
        .stat-label { font-size: 10px; color: #94a3b8; }

        /* Data Table */
        .data-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 15px; }
        .data-table th { text-align: right; color: #94a3b8; padding: 10px; border-bottom: 1px solid #334155; }
        .data-table td { padding: 10px; border-bottom: 1px solid #334155; }

        /* AI Chat */
        .ai-container { background: #1e1e2d; border-radius: 15px; padding: 15px; border: 1px solid #334155; margin-top: 20px; }
        .ai-log { height: 150px; overflow-y: auto; margin-bottom: 10px; font-size: 13px; color: #cbd5e1; }
        
        /* Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 6000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: var(--card); padding: 25px; border-radius: 20px; width: 95%; max-width: 400px; border: 1px solid #475569; max-height: 90vh; overflow-y: auto; }
        .form-input { width: 100%; padding: 12px; background: #0f172a; color: white; border: 1px solid #475569; border-radius: 8px; margin-top: 5px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- 1. Login -->
    <div id="start-screen">
        <div class="login-box">
            <h1 style="color:var(--primary); margin:0;">Yalla Scooter</h1>
            <p style="color:#64748b;">System V43</p>
            <input type="password" id="staffPass" class="inp-code" placeholder="****" inputmode="numeric">
            <button onclick="staffLogin()" style="width:100%; padding:15px; background:var(--primary); color:white; border:none; border-radius:10px; font-weight:bold;">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <!-- 2. Staff Interface -->
    <div id="app-interface" class="hidden">
        <div class="header">
            <div style="font-weight:bold; color:#fbbf24;"><i class="fas fa-bolt"></i> Yalla Scooter</div>
            <button onclick="openAdminPanel()" style="background:rgba(255,255,255,0.1); border:1px solid #475569; color:white; padding:5px 15px; border-radius:20px;">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        </div>

        <div class="container">
            <div class="action-grid">
                <button class="btn-action" style="background:var(--primary)" onclick="openNewTrip()">
                    <i class="fas fa-plus-circle" style="font-size:24px;"></i> Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
                <button class="btn-action" style="background:var(--warning); color:#000;" onclick="openMaintenanceModal()">
                    <i class="fas fa-tools" style="font-size:24px;"></i> ØªØ³Ø¬ÙŠÙ„ ØµÙŠØ§Ù†Ø©
                </button>
            </div>

            <h4 style="color:#64748b; margin-bottom:10px;">Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ©:</h4>
            <div id="trips-container"></div>
        </div>
    </div>

    <!-- 3. Admin Dashboard (Profit & Maintenance) -->
    <div id="admin-overlay">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h2>ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø£Ø¹Ø·Ø§Ù„</h2>
            <button onclick="document.getElementById('admin-overlay').style.display='none'" style="background:none; border:none; color:white; font-size:24px;">&times;</button>
        </div>

        <div class="stat-grid">
            <div class="stat-box">
                <div id="totalRev" class="stat-val" style="color:var(--success)">0</div>
                <div class="stat-label">Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø±Ø­Ù„Ø§Øª</div>
            </div>
            <div class="stat-box">
                <div id="totalRepairCost" class="stat-val" style="color:var(--danger)">0</div>
                <div class="stat-label">ØªÙƒÙ„ÙØ© Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
            </div>
            <div class="stat-box">
                <div id="netProfit" class="stat-val" style="color:#fbbf24">0</div>
                <div class="stat-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
            </div>
        </div>

        <h3>ğŸ›µ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø³ÙƒÙˆØªØ±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„</h3>
        <div style="overflow-x:auto;">
            <table class="data-table">
                <thead><tr><th>Ø§Ù„Ø³ÙƒÙˆØªØ±</th><th>Ø¯Ø®Ù„</th><th>ØµÙŠØ§Ù†Ø©</th><th>Ø±Ø¨Ø­</th><th>Ø£Ø¹Ø·Ø§Ù„</th></tr></thead>
                <tbody id="scooterTableBody"></tbody>
            </table>
        </div>

        <!-- AI Assistant -->
        <div class="ai-container">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span style="color:#fbbf24; font-weight:bold;"><i class="fas fa-brain"></i> Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ (AI)</span>
            </div>
            <div id="ai-log" class="ai-log">
                <div style="padding:10px; background:#334155; border-radius:10px;">Ø£Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ø´Ø§ÙŠÙ ÙƒÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§Ù„Ø£Ø±Ø¨Ø§Ø­. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø£Ùˆ Ø£ÙƒØªØ± Ø³ÙƒÙˆØªØ± Ø¨ÙŠØµØ±Ù Ø¹Ù„ÙŠÙ†Ø§.</div>
            </div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="ai-q" class="form-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." style="margin:0;">
                <button onclick="callRealAI()" style="background:var(--primary); color:white; border:none; padding:0 15px; border-radius:8px;"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- 4. Modals -->
    
    <!-- New Trip -->
    <div id="newTripModal" class="modal">
        <div class="modal-content">
            <h3>Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <input type="text" id="trip-scooter" class="form-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ± (S1)" style="text-transform:uppercase">
            <input type="text" id="trip-client" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
            <button onclick="startTrip()" style="width:100%; padding:15px; margin-top:15px; background:var(--primary); color:white; border:none; border-radius:10px;">Ø¨Ø¯Ø¡</button>
            <button onclick="closeModal('newTripModal')" style="width:100%; padding:10px; margin-top:5px; background:none; border:none; color:#aaa;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <!-- End Trip (Billing) -->
    <div id="endTripModal" class="modal">
        <div class="modal-content">
            <h3>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø±Ø­Ù„Ø©</h3>
            <div style="background:#0f172a; padding:15px; border-radius:10px; margin:15px 0;">
                <div style="display:flex; justify-content:space-between;">
                    <span>Ø³Ø¹Ø± Ø§Ù„ÙˆÙ‚Øª:</span> <span id="billTime">0</span>
                </div>
                <div style="display:flex; justify-content:space-between; color:var(--danger);">
                    <span>+ ØºØ±Ø§Ù…Ø© Ø¹Ø·Ù„:</span> <span id="billDamage">0</span>
                </div>
                <hr style="border-color:#334151">
                <div style="display:flex; justify-content:space-between; font-size:20px; font-weight:bold; color:var(--success);">
                    <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span> <span id="billTotal">0</span>
                </div>
            </div>

            <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                <input type="checkbox" id="hasDamage" onchange="toggleDamageInput()">
                âš ï¸ Ø¥Ø¶Ø§ÙØ© ØºØ±Ø§Ù…Ø© Ø¹Ø·Ù„
            </label>
            <div id="damageInputBox" class="hidden" style="margin-top:10px;">
                <input type="text" id="damageType" class="form-input" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„ (Ù…Ø«Ø§Ù„: ÙØ±Ø§Ù…Ù„)">
                <input type="number" id="damageCost" class="form-input" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„ØºØ±Ø§Ù…Ø©" oninput="calcTotal()">
            </div>

            <button onclick="confirmEnd()" style="width:100%; padding:15px; margin-top:20px; background:var(--danger); color:white; border:none; border-radius:10px;">ØªØ­ØµÙŠÙ„</button>
            <button onclick="closeModal('endTripModal')" style="width:100%; padding:10px; margin-top:5px; background:none; border:none; color:#aaa;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <!-- Maintenance (Workshop) -->
    <div id="maintenanceModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--warning)">ğŸ› ï¸ ÙˆØ±Ø´Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</h3>
            <p style="font-size:12px; color:#aaa;">ØªØ³Ø¬ÙŠÙ„ ØªÙƒÙ„ÙØ© Ù‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø± ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­</p>
            
            <input type="text" id="maint-scooter" class="form-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ±" style="text-transform:uppercase">
            <input type="text" id="maint-issue" class="form-input" placeholder="Ø³Ø¨Ø¨ Ø§Ù„ØªÙˆÙ‚Ù (Ù…Ø«Ø§Ù„: ØªØºÙŠÙŠØ± ÙƒØ§ÙˆØªØ´)">
            <input type="text" id="maint-parts" class="form-input" placeholder="Ù‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©">
            <input type="number" id="maint-cost" class="form-input" placeholder="Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Ø¬.Ù…)">

            <button onclick="saveMaintenance()" style="width:100%; padding:15px; margin-top:15px; background:var(--warning); color:#000; border:none; border-radius:10px; font-weight:bold;">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„</button>
            <button onclick="closeModal('maintenanceModal')" style="width:100%; padding:10px; margin-top:5px; background:none; border:none; color:#aaa;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script>
        // --- Config ---
        const GEMINI_API_KEY = "AIzaSyA1gb1AcSvcHAuc8LfcHfDkGMdWZv95Ge8";
        const firebaseConfig = {
            apiKey: "AIzaSyB2J3KViN4aZYRJ43rYGFtwkmy-jZXBO6c",
            authDomain: "yala-scooter-pro.firebaseapp.com",
            databaseURL: "https://yalla-scooter-pro-default-rtdb.firebaseio.com",
            projectId: "yalla-scooter-pro",
            storageBucket: "yalla-scooter-pro.firebasestorage.app",
            messagingSenderId: "185791475252",
            appId: "1:185791475252:web:fea7d7e2e9a18cd8a86461"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentTrip = null;
        let basePrice = 0;

        // --- 1. System Logic ---
        function staffLogin() {
            if(document.getElementById('staffPass').value === "1213") {
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('app-interface').classList.remove('hidden');
                loadTrips();
            } else Swal.fire({icon:'error', title:'ÙƒÙˆØ¯ Ø®Ø·Ø£', toast:true, background:'#1e293b', color:'#fff'});
        }

        function openAdminPanel() {
            Swal.fire({
                title: 'ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', input: 'password', background: '#1e293b', color: '#fff',
                preConfirm: (p) => { if(p !== "9924") Swal.showValidationMessage('Ø®Ø·Ø£'); }
            }).then((r) => {
                if(r.isConfirmed) {
                    document.getElementById('admin-overlay').style.display = 'block';
                    loadAdminData();
                }
            });
        }

        // --- 2. Trips ---
        function openNewTrip() { document.getElementById('newTripModal').style.display='flex'; }
        function closeModal(id) { document.getElementById(id).style.display='none'; }

        function startTrip() {
            const s = document.getElementById('trip-scooter').value.toUpperCase();
            const c = document.getElementById('trip-client').value;
            if(!s) return alert('Ø±Ù‚Ù… Ø§Ù„Ø³ÙƒÙˆØªØ± Ù…Ø·Ù„ÙˆØ¨');
            
            db.ref('active_trips').push({ scooter: s, client: c || "Ø²Ø§Ø¦Ø±", start: Date.now() });
            closeModal('newTripModal');
            document.getElementById('trip-scooter').value="";
        }

        function loadTrips() {
            db.ref('active_trips').on('value', snap => {
                const div = document.getElementById('trips-container');
                div.innerHTML = "";
                if(snap.exists()) {
                    snap.forEach(t => {
                        const trip = t.val();
                        const mins = Math.floor((Date.now() - trip.start)/60000);
                        div.innerHTML += `
                            <div class="trip-card">
                                <div>
                                    <div style="font-weight:bold; font-size:18px;">${trip.scooter}</div>
                                    <div style="color:#94a3b8; font-size:12px;">${trip.client}</div>
                                </div>
                                <div style="font-family:monospace; font-size:24px; color:var(--primary)">${mins} Ø¯</div>
                                <button onclick="openEndTrip('${t.key}')" style="background:var(--danger); color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">Ø¥Ù†Ù‡Ø§Ø¡</button>
                            </div>
                        `;
                    });
                } else div.innerHTML = "<p style='text-align:center; color:#555'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø­Ù„Ø§Øª</p>";
            });
        }

        // --- 3. Billing & Damage ---
        function openEndTrip(key) {
            db.ref('active_trips/'+key).once('value', snap => {
                currentTrip = { ...snap.val(), key: key };
                let mins = Math.ceil((Date.now() - currentTrip.start)/60000);
                if(mins < 15) mins = 15;
                basePrice = mins * 1; // Ø³Ø¹Ø± Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©

                document.getElementById('billTime').innerText = basePrice;
                document.getElementById('billDamage').innerText = "0";
                document.getElementById('billTotal').innerText = basePrice;
                
                document.getElementById('hasDamage').checked = false;
                document.getElementById('damageInputBox').classList.add('hidden');
                document.getElementById('damageCost').value = "";
                
                document.getElementById('endTripModal').style.display = 'flex';
            });
        }

        function toggleDamageInput() {
            const chk = document.getElementById('hasDamage').checked;
            document.getElementById('damageInputBox').classList.toggle('hidden', !chk);
            calcTotal();
        }

        function calcTotal() {
            let dmg = 0;
            if(document.getElementById('hasDamage').checked) {
                dmg = parseFloat(document.getElementById('damageCost').value) || 0;
            }
            document.getElementById('billDamage').innerText = dmg;
            document.getElementById('billTotal').innerText = basePrice + dmg;
        }

        function confirmEnd() {
            const dmgCost = parseFloat(document.getElementById('billDamage').innerText);
            const total = basePrice + dmgCost;
            const hasDmg = document.getElementById('hasDamage').checked;
            const dmgType = document.getElementById('damageType').value;

            // Save to Scooter Stats (Revenue Update)
            db.ref(`scooters/${currentTrip.scooter}`).transaction(s => {
                return {
                    totalRevenue: (s?.totalRevenue || 0) + total,
                    breakdownCount: (s?.breakdownCount || 0) + (hasDmg ? 1 : 0),
                    totalRepairCost: (s?.totalRepairCost || 0) // Keeps existing
                };
            });

            // Save History
            const today = new Date().toISOString().split('T')[0];
            db.ref(`history/${today}`).push({
                ...currentTrip, end: Date.now(), 
                timeCost: basePrice, damageFee: dmgCost, totalBill: total,
                damageType: hasDmg ? dmgType : null
            });

            db.ref('active_trips/'+currentTrip.key).remove();
            closeModal('endTripModal');
            Swal.fire({icon:'success', title:'ØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„', text:`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬.Ù…`, toast:true, background:'#1e293b', color:'#fff'});
        }

        // --- 4. Maintenance Logic ---
        function openMaintenanceModal() { document.getElementById('maintenanceModal').style.display='flex'; }

        function saveMaintenance() {
            const sc = document.getElementById('maint-scooter').value.toUpperCase();
            const issue = document.getElementById('maint-issue').value;
            const parts = document.getElementById('maint-parts').value;
            const cost = parseFloat(document.getElementById('maint-cost').value) || 0;

            if(!sc || !cost) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');

            // 1. Log to maintenance history
            db.ref('maintenance_log').push({
                scooter: sc, issue, parts, cost, date: Date.now()
            });

            // 2. Update Scooter Stats (Add to Expense)
            db.ref(`scooters/${sc}`).transaction(s => {
                return {
                    totalRevenue: (s?.totalRevenue || 0),
                    breakdownCount: (s?.breakdownCount || 0) + 1,
                    totalRepairCost: (s?.totalRepairCost || 0) + cost
                };
            });

            closeModal('maintenanceModal');
            Swal.fire({icon:'success', title:'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø©', text:`ØªÙƒÙ„ÙØ©: ${cost} Ø¬.Ù…`, background:'#1e293b', color:'#fff'});
            
            // Clear inputs
            document.getElementById('maint-scooter').value="";
            document.getElementById('maint-cost').value="";
        }

        // --- 5. Admin Dashboard & AI ---
        function loadAdminData() {
            db.ref('scooters').on('value', snap => {
                const tbody = document.getElementById('scooterTableBody');
                tbody.innerHTML = "";
                let grandRevenue = 0;
                let grandRepair = 0;

                if(snap.exists()) {
                    snap.forEach(s => {
                        const val = s.val();
                        const rev = val.totalRevenue || 0;
                        const rep = val.totalRepairCost || 0;
                        const profit = rev - rep;
                        
                        grandRevenue += rev;
                        grandRepair += rep;

                        tbody.innerHTML += `
                            <tr>
                                <td style="font-weight:bold; color:white">${s.key}</td>
                                <td style="color:var(--success)">${rev}</td>
                                <td style="color:var(--danger)">${rep}</td>
                                <td style="color:${profit>=0 ? '#fbbf24':'red'}">${profit}</td>
                                <td>${val.breakdownCount || 0}</td>
                            </tr>
                        `;
                    });
                }
                
                document.getElementById('totalRev').innerText = grandRevenue;
                document.getElementById('totalRepairCost').innerText = grandRepair;
                document.getElementById('netProfit').innerText = grandRevenue - grandRepair;
            });
        }

        async function callRealAI() {
            const q = document.getElementById('ai-q').value;
            const log = document.getElementById('ai-log');
            if(!q) return;

            log.innerHTML += `<div style="color:#3b82f6; margin:5px 0;">You: ${q}</div>`;
            document.getElementById('ai-q').value = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";

            // Context from Dashboard
            const rev = document.getElementById('totalRev').innerText;
            const repair = document.getElementById('totalRepairCost').innerText;
            const profit = document.getElementById('netProfit').innerText;

            const prompt = `
                Ø£Ù†Øª Ù…Ø­Ø§Ø³Ø¨ Ø°ÙƒÙŠ Ù„Ù…Ø­Ù„ Ø³ÙƒÙˆØªØ±Ø§Øª.
                Ø¨ÙŠØ§Ù†Ø§ØªÙ†Ø§ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:
                - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯: ${rev} Ø¬Ù†ÙŠÙ‡
                - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆÙ‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø±: ${repair} Ø¬Ù†ÙŠÙ‡
                - ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: ${profit} Ø¬Ù†ÙŠÙ‡
                
                Ø¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "${q}"
                (Ù„Ùˆ Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ø±Ø¨Ø­ Ø£Ùˆ Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ø´Ø±Ø­Ù„Ù‡ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©).
            `;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                const reply = data.candidates[0].content.parts[0].text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
                log.innerHTML += `<div style="color:#fbbf24; margin:5px 0;">AI: ${reply}</div>`;
            } catch (e) {
                log.innerHTML += `<div style="color:red">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>`;
            }
            
            document.getElementById('ai-q').value = "";
            log.scrollTop = log.scrollHeight;
        }
    </script>
</body>
</html>
