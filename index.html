<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yalla Scooter | Official App</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <!-- 1. شاشة الدخول (الاستقبال) -->
    <div id="auth-screen" style="position:fixed; inset:0; background:white; z-index:10000; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px;">
        <svg width="100" viewBox="0 0 100 100"><path d="M20 20 L40 50 L40 85 M40 50 L60 20" stroke="#0066ff" stroke-width="12" fill="none" stroke-linecap="round"/></svg>
        <h1 style="color:#0066ff; font-family:Orbitron; letter-spacing:2px; margin:20px 0 40px 0;">YALLA</h1>
        <input type="tel" id="uPhone" style="width:100%; padding:18px; border-radius:15px; border:1px solid #eee; text-align:center; font-size:18px; background:#f4f8ff;" placeholder="رقم الهاتف">
        <button onclick="login()" style="width:100%; padding:18px; border-radius:50px; background:#0066ff; color:white; border:none; font-weight:900; font-size:18px; margin-top:15px;">دخول</button>
    </div>

    <!-- 2. واجهة التطبيق الرئيسية -->
    <div id="app-main" style="display:none;">
        <div id="map"></div>
        
        <div class="hud">
            <div class="info-tag"><i class="fas fa-walking" style="color:#0066ff"></i> <span id="walk-time">--</span> دقيقة مشي</div>
            <button class="fab btn-chat-ai" onclick="openPage('chat')"><i class="fas fa-comment-dots"></i></button>
            <button class="fab btn-menu" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
            <button class="fab btn-locate" onclick="locateMe()"><i class="fas fa-crosshairs"></i></button>
            <button class="btn-scan-main" onclick="openScanner()"><i class="fas fa-qrcode"></i> SCAN TO RIDE</button>
        </div>

        <div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
        <nav id="side-menu">
            <div class="menu-link" onclick="openPage('wallet')"><i class="fas fa-wallet"></i> المحفظة <span class="live-bal" style="margin-right:auto">0.00</span></div>
            <div class="menu-link" onclick="openPage('history')"><i class="fas fa-history"></i> سجل الرحلات</div>
            <div class="menu-link" onclick="openPage('chat')"><i class="fas fa-headset"></i> الدعم والموظف المباشر</div>
            <div class="menu-link" onclick="logout()" style="margin-top:auto; color:red; border:none;"><i class="fas fa-sign-out-alt"></i> خروج</div>
        </nav>
    </div>

    <!-- صفحات المحفظة والشات -->
    <div id="pg-chat" class="full-page">
        <div class="pg-header"><i class="fas fa-chevron-left" onclick="closePage('chat')"></i> الدعم المباشر <i></i></div>
        <div id="chat-window" style="flex:1; overflow-y:auto; padding:20px; background:#f9f9fb; display:flex; flex-direction:column;"></div>
        <div style="padding:15px; display:flex; gap:10px; border-top:1px solid #eee;">
            <input type="text" id="chatInp" placeholder="اكتب سؤالك..." style="flex:1; border:none; background:#f0f5ff; padding:15px; border-radius:15px;">
            <button onclick="sendMsg()" style="width:50px; height:50px; background:#0066ff; color:white; border-radius:50%; border:none;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="app-brain.js"></script>
    <script>
        // كود الربط النهائي للواجهة
        function login() {
            const ph = document.getElementById('uPhone').value;
            if(ph.length < 11) return;
            localStorage.setItem('y_titan_verified', ph);
            location.reload();
        }
        if(localStorage.getItem('y_titan_verified')) {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app-main').style.display = 'block';
            const map = L.map('map', {zoomControl:false}).setView([30.0444, 31.2357], 16);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
            YallaBrain.startGPS(map);
        }
        function toggleMenu() { document.getElementById('side-menu').classList.toggle('open'); document.getElementById('overlay').style.display = document.getElementById('side-menu').classList.contains('open') ? 'block' : 'none'; }
        function openPage(id) { document.getElementById('pg-'+id).style.display='flex'; }
        function closePage(id) { document.getElementById('pg-'+id).style.display='none'; }
    </script>
</body>
</html>
